<html>

<head>
  <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<title>关于使用puppeteer的screenshot截图乱码 | 庵主老衲来也</title>
<link rel="shortcut icon" href="https://he5050.github.io/favicon.ico?v=1562816420003">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
  integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
<link rel="stylesheet" href="https://he5050.github.io/styles/main.css" type='text/css' media='all'>

<script src="https://he5050.github.io/media/scripts/lib/scrollreveal.min.js"></script>

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">



  <style>
    .toc-card {
      position: absolute;
      top: 0;
      right: -280px;
      transition: all .5s;
      width: 300px;
      background-color: #ee4d4d;
      color: #fff;
      height: 400px;
      overflow: hidden;
    }

    .toc-content {
      width: 170%;
      height: 100%;
      overflow-x: hidden;
      overflow-y: scroll;
      padding: 10px 20px;
    }

    .toc-content>ul {
      margin: 0 !important;
      list-style-type: none;
    }

    .toc-content>ul>li>ul {
      list-style-type: simp-chinese-informal;
    }

    .toc-content>ul>li>ul ul {
      list-style-type: decimal-leading-zero;
    }

    .toc-card ul li a {
      color: #fff;
      transition: all .25s;
      white-space: nowrap;
      text-overflow: ellipsis;
    }

    .toc-card ul li a:hover {
      font-size: 20px;
      text-decoration: underline;
      text-decoration-color: #000;
      text-decoration-style: wavy;

    }
  </style>
</head>

<body class="home blog ct-body standard">
  <canvas id="canvas" class="canvas"></canvas>
  <div id="overflow-container" class="overflow-container">
    <header id="site-header" class="site-header" role="banner">


    <div class="container">
        <div id="title-info" class="title-info">
            <div id='site-title' class='site-title'>
                <a href="https://he5050.github.io"> 庵主老衲来也 </a>
            </div>
        </div>
        <button id="toggle-navigation" class="toggle-navigation">
            <i class="fa fa-bars"></i>
        </button>
        <div id="menu-primary-tracks" class="menu-primary-tracks"></div>
        <div id="menu-primary" class="menu-container menu-primary" role="navigation">
            <p class="site-description">五年前端三年切图@怡红院
</p>
            <div class="menu">
                <ul id="menu-primary-items" class="menu-primary-items">
                    
                    
                    <li id="menu-item"
                        class='menu-item menu-item-type-post_type menu-item-object-page current-menu-item current_page_item'>
                        <a href="/">首页</a>
                    </li>
                    
                    
                    
                    <li id="menu-item"
                        class='menu-item menu-item-type-post_type menu-item-object-page current-menu-item current_page_item'>
                        <a href="/archives">归档</a>
                    </li>
                    
                    
                    
                    <li id="menu-item"
                        class='menu-item menu-item-type-post_type menu-item-object-page current-menu-item current_page_item'>
                        <a href="/tags">标签</a>
                    </li>
                    
                    
                    
                    <li id="menu-item"
                        class='menu-item menu-item-type-post_type menu-item-object-page current-menu-item current_page_item'>
                        <a href="http://www.leeling.top/" target="_blank">自用播放器</a>
                    </li>
                    
                    
                </ul>
            </div>
        </div>
    </div>


</header>


    <div id="main" class="main" role="main">
      
      
<div class="toc-card i-card ">
  <!-- <div class="toc-title i-card-title">目录</div> -->
  <div class="toc-content">
    <ul class="markdownIt-TOC">
<li><a href="#screenshot%E6%88%AA%E5%9B%BE%E4%B9%B1%E7%A0%81">screenshot截图乱码</a>
<ul>
<li><a href="#%E9%97%AE%E9%A2%98">问题</a></li>
<li><a href="#%E8%A7%A3%E5%86%B3">解决</a>
<ul>
<li><a href="#%E5%AE%89%E8%A3%85fontconfig">安装fontconfig</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0%E4%B8%AD%E6%96%87%E5%AD%97%E4%BD%93%E5%BA%93">添加中文字体库</a></li>
<li><a href="#%E8%A1%A5%E5%85%85">补充</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
</div>


      
      <div id="loop-container" class="loop-container">
        <div
          class="post type-post status-publish format-standard has-post-thumbnail hentry category-design tag-design tag-standard-2 tag-tagalicious tag-travel entry full-without-featured odd excerpt-1">
          
          <div class='featured-image lazy lazy-bg-image max-bg' data-background="http://ww1.sinaimg.cn/large/69abf49bly1g4lcjokqzhj21hc0u0gvh.jpg">
          </div>
          

          <div class="entry-meta">
            <span class="date">· 2019年 02/07 Tue ·</span>

            
            <span class="category">
              <span> / </span>
              <a href="https://he5050.github.io/tag/PbtT_RHgp">puppeteer</a>
            </span>
            
            <span class="category">
              <span> / </span>
              <a href="https://he5050.github.io/tag/ie2_l5xTf">乱码</a>
            </span>
            
          </div>
          <div class='entry-header'>
            <h1 class='entry-title'>关于使用puppeteer的screenshot截图乱码</h1>
          </div>
          <div class="entry-container">
            <div class="entry-content">
              <article>
                <p>前一会得空写了一个微信小助手，发现在centos上面发微信发送图片为乱码</p>
<!-- more -->
<h1 id="screenshot截图乱码">screenshot截图乱码</h1>
<p>如图所示：
<img src="http://ww1.sinaimg.cn/large/69abf49bly1g4ujzb8b9gj20bi0kg79e.jpg" alt=""></p>
<h2 id="问题">问题</h2>
<p>后面在网上查了一下原来是因为字体库的问题</p>
<h2 id="解决">解决</h2>
<h3 id="安装fontconfig">安装fontconfig</h3>
<ul>
<li><code>yum -y install fontconfig</code></li>
<li>在执行完上述命令后，就可以在<code>/usr/share</code>文件里面的<code>fonts</code>和<code>fontconfig</code></li>
</ul>
<h3 id="添加中文字体库">添加中文字体库</h3>
<ul>
<li>在CentOS的/usr/share/fonts新建一个叫chinese的文件夹<code>mkdir /usr/share/fonts/chinese</code></li>
<li>从<code>window</code>的<code>C:\Windows\Fonts</code>里面把你需要的字体拷贝出来。比如说我需要宋体，我就选择<code>simsun.ttc</code>上传到<code>/usr/share/fonts/chinese</code></li>
<li>修改chinese目录的权限。<code>chmod -R 775 /usr/share/fonts/chinese</code></li>
<li>接下来需要安装ttmkfdir来搜索目录中所有的字体信息，并汇总生成fonts.scale文件，输入命令<code>yum -y install ttmkfdir</code></li>
<li>执行ttmkfdir命令，<code>ttmkfdir -e /usr/share/X11/fonts/encodings/encodings.dir</code></li>
<li>修改字体配置文件，<code>vi /etc/fonts/fonts.conf</code></li>
</ul>
<p><img src="http://ww1.sinaimg.cn/large/69abf49bly1g4uk88063gj20gx06eglj.jpg" alt=""></p>
<ul>
<li>刷新内存中的字体缓存，<code>fc-cache</code></li>
<li>看一下现在机器上已经有了刚才添加的字体。<code>fc-list :lang=zh</code>,<code>fc-list</code></li>
</ul>
<h3 id="补充">补充</h3>
<blockquote>
<p>在centos上面使用puppeteer时创建Page要注意使用无头配置</p>
</blockquote>
<pre><code class="language-js">const browser = await puppeteer.launch({
        ignoreHTTPSErrors: true,
        headless: true,
        defaultViewport: {
            // tips: 标准2倍图 750 1334
            // width: 375 ,
            // height: 812
            width: 414,
            height: 736
        },
        args: [&quot;--no-sandbox&quot;, &quot;--disable-setuid-sandbox&quot;]
    });
</code></pre>

              </article>
            </div>
          </div>
          
          <nav class="navigation pagination" role="navigation">
            <h2 class="screen-reader-text">Posts navigation</h2>
            <div class="nav-links">
              <a class="next page-numbers" style="font-size:20px"
                href="https://he5050.github.io/post/xiang-feng-yi-chang-rang-ni-shi-wang-liao">下一篇->相逢一场 让你失望了</a>
            </div>
          </nav>
          
        </div>
        <section id="comments" class="comments">
          
        </section>
      </div>
    </div>
    <footer id="site-footer" class="site-footer" role="contentinfo">
    <h1 class="site-header">
        <a href="https://he5050.github.io"> 庵主老衲来也 </a>
    </h1>
    <p class="site-description" style="font-size:18px">五年前端三年切图@怡红院
</p>
    <div id="menu-footer" class="menu-container menu-footer" role="navigation">
        <div class="menu">
            <ul id="menu-footer-items" class="menu-footer-items">
            </ul>
        </div>
    </div>
    <ul class="social-media-icons">
        
        
        <li>
            <a href="https://github.com/he5050" data-animate-hover="pulse" class="github" target="_blank">
                <i class="fab fa-github"
                    title="github"></i>
                <span class="screen-reader-text">github</span>
            </a>
        </li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    </ul>
    <div class="design-credit">
        <p><span class="footer-tips">天赋决定了你能达到的上限，努力程度决定了你能达到的下限。以绝大多数人的努力程度之低，远远没有达到要去拼天赋的地步。</span></p>
    </div>
</footer>
<script>
    WIDGET = { ID: 'uN0i1Pg6Tc' };
    hljs.initHighlightingOnLoad()
    window._info = {

        timer: new Date().getTime(),

    };
</script>
<script src="https://pv.sohu.com/cityjson?ie=utf-8"></script>
<script type="text/javascript" src="https://apip.weatherdt.com/view/static/js/r.js?v=1111"></script>
<script src="https://he5050.github.io/media/scripts/lib/jquery.min.js"></script>
<script src="https://he5050.github.io/media/scripts/lib/jquerymigrate.js"></script>
<script src="https://he5050.github.io/media/scripts/lib/production.min.js"></script>
<script src="https://he5050.github.io/media/scripts/lib/calendar.js"></script>
<script src="https://he5050.github.io/media/scripts/lib/clock.js"></script>

  </div>
  <script>
    var throttle = function (action, delay) {
      var last = 0;
      return function () {
        var curr = +new Date();
        if (curr - last > delay) {
          action.apply(this, arguments);
          last = curr;
        }
      };
    };

    var toc = $(".toc-card");
    if (toc.length > 0) {
      var initTop = $(".entry-content").offset().top
      toc.css("top", initTop);
      var navigation = 0;
      var nav = $(".navigation");
      if (nav.length > 0) {
        navigation = $(".navigation").offset().top;
      } else {
        navigation = $(".site-footer").offset().top;
      }
      window.addEventListener(
        "scroll",
        throttle(function () {
          var top = 0;
          var scrollTop =
            window.pageYOffset ||
            document.documentElement.scrollTop ||
            document.body.scrollTop;
          if (scrollTop >= initTop + 10) {
            top = scrollTop > navigation ? navigation + toc.height() : scrollTop;
          } else {
            top = initTop;
          }
          // 判断是否到底部了
          console.log(`comment:${navigation}, scrollTop: ${scrollTop}, top: ${top}`);
          toc.css("top", top);
        }, 50)
      );
    }

  </script>
</body>

</html>
