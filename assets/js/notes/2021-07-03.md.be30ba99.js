(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{430:function(e,a,t){"use strict";t.r(a),function(e){t.d(a,"default",(function(){return d}));var n,c=t(168),s=(t(407),t(0),t(169)),o=["components"];function p(){return(p=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function b(e,a){if(null==e)return{};var t,n,c=function(e,a){if(null==e)return{};var t,n,c={},s=Object.keys(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||(c[t]=e[t]);return c}(e,a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(c[t]=e[t])}return c}(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e);"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;var m,N,r=function(e){return function(a){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(s.b)("div",a)}},u=r("Footer"),l={};function d(e){var a=e.components,t=b(e,o);return Object(s.b)("wrapper",p({},l,t,{components:a,mdxType:"MDXLayout"}),Object(s.b)("blockquote",null,Object(s.b)(u,{mdxType:"Footer"})),Object(s.b)("h1",{className:"__internal",id:"10redux简介"},"10.Redux简介",Object(s.b)("a",{parentName:"h1",href:"#10redux%E7%AE%80%E4%BB%8B","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},"这里要讲的就是一个Redux在React中的应用问题，讲一讲",Object(s.b)("inlineCode",{parentName:"p"},"Redux"),"，",Object(s.b)("inlineCode",{parentName:"p"},"react-redux"),"，",Object(s.b)("inlineCode",{parentName:"p"},"redux-thunk"),"，",Object(s.b)("inlineCode",{parentName:"p"},"redux-actions"),"，",Object(s.b)("inlineCode",{parentName:"p"},"redux-promise"),"，",Object(s.b)("inlineCode",{parentName:"p"},"redux-sage"),"这些包的作用和他们解决的问"),Object(s.b)("h3",{parentName:"blockquote",className:"__internal",id:"redux"},"Redux",Object(s.b)("a",{parentName:"h3",href:"#redux","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("p",{parentName:"blockquote"},"先看看百度百科上面Redux的一张图：\n",Object(s.b)("img",{parentName:"p",src:"/images/redux.jpg",alt:null}))),Object(s.b)("p",null,"这是Redux在Github上的介绍：Redux用于js程序，是一个可预测的状态容器。"),Object(s.b)("p",null,"在这里我们首先要明白的是什么叫可预测？什么叫状态容器？"),Object(s.b)("p",null,"什么叫状态？实际上就是变量，对话框显示或隐藏的变量，一杯奶茶多少钱的变量。"),Object(s.b)("p",null,"那么这个状态容器，实际上就是一个存放这些变量的变量。"),Object(s.b)("p",null,"你创建了一个全局变量叫",Object(s.b)("inlineCode",{parentName:"p"},"Store"),"，然后将代码中控制各个状态的变量存放在里面，那么现在",Object(s.b)("inlineCode",{parentName:"p"},"Store"),"就叫做状态容器。"),Object(s.b)("p",null,"什么叫可预测？"),Object(s.b)("p",null,"你在操作这个",Object(s.b)("inlineCode",{parentName:"p"},"Store"),"的时候，总是用",Object(s.b)("inlineCode",{parentName:"p"},"Store.price"),"的方式来设置值，这种操作数据的方式很原始，对于复杂的系统而言永远都不知道程序在运行的过程中发生了什么。"),Object(s.b)("p",null,"那么现在我们都通过发送一个",Object(s.b)("inlineCode",{parentName:"p"},"Action"),"去做修改，而",Object(s.b)("inlineCode",{parentName:"p"},"Store"),"在接收到",Object(s.b)("inlineCode",{parentName:"p"},"Action"),"后会使用",Object(s.b)("inlineCode",{parentName:"p"},"Reducer"),"对",Object(s.b)("inlineCode",{parentName:"p"},"Action"),"传递的数据做处理，最后应用到",Object(s.b)("inlineCode",{parentName:"p"},"Store"),"中。"),Object(s.b)("p",null,"相对于",Object(s.b)("inlineCode",{parentName:"p"},"Store.price"),"的方式来修改者，这种方式无疑更麻烦，但是这种方式的好处就是，每一个",Object(s.b)("inlineCode",{parentName:"p"},"Action"),"里面都可以写日志，可以记录各种状态的变动，这就是可预测。"),Object(s.b)("p",null,"所以如果你的程序很简单，你完全没有必要去用",Object(s.b)("inlineCode",{parentName:"p"},"Redux"),"。"),Object(s.b)("p",null,"看看",Object(s.b)("inlineCode",{parentName:"p"},"Redux"),"的示例代码："),Object(s.b)("p",null,"actionTypes.js："),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"CHANGE_BTN_TEXT")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'CHANGE_BTN_TEXT'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"actions.js："),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"*")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"as")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"T")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'./actionTypes'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"changeBtnText")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"text"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    type",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"T"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token constant"},"CHANGE_BTN_TEXT"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n    payload",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," text\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"reducers.js："),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"*")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"as")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"T")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'./actionTypes'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," initialState ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  btnText",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'我是按钮'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"pageMainReducer")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"state ",Object(s.b)("span",{parentName:"span",className:"token operator"},"=")," initialState",Object(s.b)("span",{parentName:"span",className:"token punctuation"},",")," action"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"switch")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"action",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"type",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"case")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"T"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token constant"},"CHANGE_BTN_TEXT"),Object(s.b)("span",{parentName:"code",className:"token operator"},":"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token operator"},"..."),"state",Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n        btnText",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," action",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"payload\n      ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"default"),Object(s.b)("span",{parentName:"code",className:"token operator"},":"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," state",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"default")," pageMainReducer",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"index.js"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," createStore ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'redux'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," reducer ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'./reducers'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," changeBtnText ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'./actions'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," store ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"createStore"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"reducer",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 开始监听，每次state更新，那么就会打印出当前状态"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," unsubscribe ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," store",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"subscribe"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"info"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"store",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"getState"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 发送消息"),"\nstore",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"dispatch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token function"},"changeBtnText"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},"'点击了按钮'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 停止监听state的更新"),"\n",Object(s.b)("span",{parentName:"code",className:"token function"},"unsubscribe"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"这里就不解释什么语法作用了，网上这样的资料太多了。"),Object(s.b)("p",null,Object(s.b)("inlineCode",{parentName:"p"},"Redux"),"与",Object(s.b)("inlineCode",{parentName:"p"},"React"),"的结合：",Object(s.b)("inlineCode",{parentName:"p"},"react-redux"),"\n",Object(s.b)("inlineCode",{parentName:"p"},"Redux"),"是一个可预测的状态容器，跟",Object(s.b)("inlineCode",{parentName:"p"},"React"),"这种构建UI的库是两个相互独立的东西。"),Object(s.b)("p",null,Object(s.b)("inlineCode",{parentName:"p"},"Redux"),"要应用到",Object(s.b)("inlineCode",{parentName:"p"},"React"),"中，很明显",Object(s.b)("inlineCode",{parentName:"p"},"action"),"，",Object(s.b)("inlineCode",{parentName:"p"},"reducer"),"，",Object(s.b)("inlineCode",{parentName:"p"},"dispatch"),"这几个阶段并不需要改变，唯一需要考虑的是redux中的状态需要如何传递给react组件。"),Object(s.b)("p",null,"很简单，只需要每次要更新数据时运用",Object(s.b)("inlineCode",{parentName:"p"},"store.getState"),"获取到当前状态，并将这些数据传递给组件即可。"),Object(s.b)("p",null,"那么问题来了，如何让每个组件都获取到",Object(s.b)("inlineCode",{parentName:"p"},"store"),"呢？"),Object(s.b)("p",null,"当然是将",Object(s.b)("inlineCode",{parentName:"p"},"store"),"作为一个值传递给根组件，然后",Object(s.b)("inlineCode",{parentName:"p"},"store"),"就会一级一级往下传，使得每个组件都能获取到",Object(s.b)("inlineCode",{parentName:"p"},"store"),"的值。"),Object(s.b)("p",null,"但是这样太繁琐了，难道每个组件需要写一个传递",Object(s.b)("inlineCode",{parentName:"p"},"store"),"的逻辑？为了解决这个问题，那么得用到React的context玩法，通过在根组件上将store放在根组件的context中，然后在子组件中通过context获取到store。"),Object(s.b)("p",null,Object(s.b)("inlineCode",{parentName:"p"},"react-redux"),"的主要思路也是如此，通过嵌套组件",Object(s.b)("inlineCode",{parentName:"p"},"Provider"),"将",Object(s.b)("inlineCode",{parentName:"p"},"store"),"放到",Object(s.b)("inlineCode",{parentName:"p"},"context"),"中，通过",Object(s.b)("inlineCode",{parentName:"p"},"connect"),"这个高阶组件，来隐藏取",Object(s.b)("inlineCode",{parentName:"p"},"store"),"的操作，这样我们就不需要每次去操作",Object(s.b)("inlineCode",{parentName:"p"},"context"),"写一大堆代码那么麻烦了。"),Object(s.b)("p",null,"然后我们再来基于之前的Redux示例代码给出react-redux的使用演示代码，其中action和reduce部分不变，先增加一个组件PageMain："),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"PageMain")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"props"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"\n    ",Object(s.b)("span",{parentName:"code",className:"token operator"},"<"),"div",Object(s.b)("span",{parentName:"code",className:"token operator"},">"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token operator"},"<"),"button onClick",Object(s.b)("span",{parentName:"code",className:"token operator"},"="),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        props",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"changeText"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},"'按钮被点击了'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token operator"},">"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"props",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"btnText",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token operator"},"<"),Object(s.b)("span",{parentName:"code",className:"token operator"},"/"),"button",Object(s.b)("span",{parentName:"code",className:"token operator"},">"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token operator"},"<"),Object(s.b)("span",{parentName:"code",className:"token operator"},"/"),"div",Object(s.b)("span",{parentName:"code",className:"token operator"},">"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 映射store.getState()的数据到PageMain"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"mapStateToProps")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"state"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    btnText",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," state",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"pageMain",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"btnText",Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 映射使用了store.dispatch的函数到PageMain"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"mapDispatchToProps")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"dispatch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"changeText"),Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"text"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token function"},"dispatch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token function"},"changeBtnText"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"text",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 这个地方也可以简写，react-redux会自动做处理"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," mapDispatchToProps ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  changeText",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," changeBtnText\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"default")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"connect"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"mapStateToProps",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," mapDispatchToProps",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"PageMain",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"注意上面的state.pageMain.btnText，这个pageMain是我用redux的combineReducers将多个reducer合并后给的原先的reducer一个命名。"),Object(s.b)("p",null,"它的代码如下："),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," combineReducers ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'redux'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," pageMain ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'./components/pageMain/reducers'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," reducer ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"combineReducers"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  pageMain\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"default")," reducer",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"然后修改index.js:"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," React ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'react'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," createStore ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'redux'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," Provider ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'react-redux'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ReactDOM ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'react-dom'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," reducer ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'./reducers'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," PageMain ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'./components/pageMain'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," store ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"createStore"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"reducer",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"App")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"\n  ",Object(s.b)("span",{parentName:"code",className:"token operator"},"<"),"Provider store",Object(s.b)("span",{parentName:"code",className:"token operator"},"="),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"store",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token operator"},">"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token operator"},"<"),"PageMain ",Object(s.b)("span",{parentName:"code",className:"token operator"},"/"),Object(s.b)("span",{parentName:"code",className:"token operator"},">"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token operator"},"<"),Object(s.b)("span",{parentName:"code",className:"token operator"},"/"),"Provider",Object(s.b)("span",{parentName:"code",className:"token operator"},">"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\nReactDOM",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"render"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token operator"},"<"),"App ",Object(s.b)("span",{parentName:"code",className:"token operator"},"/"),Object(s.b)("span",{parentName:"code",className:"token operator"},">"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," document",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"getElementById"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},"'app'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"Redux的中间件\n之前我们讲到Redux是个可预测的状态容器，这个可预测在于对数据的每一次修改都可以进行相应的处理和记录。"),Object(s.b)("p",null,"假如现在我们需要在每次修改数据时，记录修改的内容，我们可以在每一个dispatch前面加上一个console.info记录修改的内容。"),Object(s.b)("p",null,"但是这样太繁琐了，所以我们可以直接修改store.dispatch："),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," next ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," store",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"dispatch\nstore",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"dispatch")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"action"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"info"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},"'修改内容为：'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," action",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token function"},"next"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"action",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")))),Object(s.b)("p",null,"Redux中也有同样的功能，那就是applyMiddleware。直译过来就是“应用中间件”，它的作用就是改造dispatch函数，跟上面的玩法基本雷同。"),Object(s.b)("p",null,"来一段演示代码："),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," createStore",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," applyMiddleware ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'redux'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," reducer ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'./reducers'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," store ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"createStore"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"reducer",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"applyMiddleware"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"curStore")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token parameter"},"next")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token parameter"},"action")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"info"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"curStore",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"getState"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," action",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"next"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"action",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"看起来挺奇怪的玩法，但是理解起来并不难。通过这种返回函数的方法，使得applyMiddleware内部以及我们使用时可以处理store和action，并且这里next的应用就是为了使用多个中间件而存在的。"),Object(s.b)("p",null,"而通常我们没有必要自己写中间件，比如日志的记录就已经有了成熟的中间件：redux-logger，这里给一个简单的例子："),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," applyMiddleware",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," createStore ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'redux'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," createLogger ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'redux-logger'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," reducer ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'./reducers'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," logger ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"createLogger"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," store ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"createStore"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"\n  reducer",Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n  ",Object(s.b)("span",{parentName:"code",className:"token function"},"applyMiddleware"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"logger",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"这样就可以记录所有action及其发送前后的state的日志，我们可以了解到代码实际运行时到底发生了什么。"),Object(s.b)("p",null,"redux-thunk：处理异步action\n在上面的代码中，我们点击按钮后，直接修改了按钮的文本，这个文本是个固定的值。"),Object(s.b)("p",null,"actions.js："),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"*")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"as")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"T")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'./actionTypes'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"changeBtnText")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"text"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    type",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"T"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token constant"},"CHANGE_BTN_TEXT"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n    payload",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," text\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"但是在我们实际生产的过程中，很多情况都是需要去请求服务端拿到数据再修改的，这个过程是一个异步的过程。又或者需要setTimeout去做一些事情。"),Object(s.b)("p",null,"我们可以去修改这一部分如下："),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"mapDispatchToProps")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"dispatch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"changeText"),Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"text"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token function"},"dispatch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token function"},"changeBtnText"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},"'正在加载中'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n      axios",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"get"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},"'http://test.com'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"then"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token function"},"dispatch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token function"},"changeBtnText"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},"'加载完毕'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"catch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token function"},"dispatch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token function"},"changeBtnText"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},"'加载有误'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"实际上，我们每天不知道要处理多少这样的代码。"),Object(s.b)("p",null,"但是问题来了，异步操作相比同步操作多了一个很多确定因素，比如我们展示正在加载中时，可能要先要做异步操作A，而请求后台的过程却非常快，导致加载完毕先出现，而这时候操作A才做完，然后再展示加载中。"),Object(s.b)("p",null,"所以上面的这个玩法并不能满足这种情况。"),Object(s.b)("p",null,"这个时候我们需要去通过store.getState获取当前状态，从而判断到底是展示正在加载中还是展示加载完毕。"),Object(s.b)("p",null,"这个过程就不能放在mapDispatchToProps中了，而需要放在中间件中，因为中间件中可以拿到store。"),Object(s.b)("p",null,"首先创造store的时候需要应用react-thunk，也就是"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," createStore",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," applyMiddleware ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'redux'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," thunk ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'redux-thunk'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," reducer ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'./reducers'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," store ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"createStore"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"\n  reducer",Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n  ",Object(s.b)("span",{parentName:"code",className:"token function"},"applyMiddleware"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"thunk",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 它的源码超级简单："),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"createThunkMiddleware"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"extraArgument"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{")," dispatch",Object(s.b)("span",{parentName:"span",className:"token punctuation"},",")," getState ",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}")),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token parameter"},"next")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token parameter"},"action")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token keyword"},"typeof")," action ",Object(s.b)("span",{parentName:"code",className:"token operator"},"===")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'function'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"action"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"dispatch",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," getState",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," extraArgument",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"next"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"action",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," thunk ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"createThunkMiddleware"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\nthunk",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"withExtraArgument ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," createThunkMiddleware",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"default")," thunk",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"从这个里面可以看出，它就是加强了dispatch的功能，在dispatch一个action之前，去判断action是否是一个函数，如果是函数，那么就执行这个函数。"),Object(s.b)("p",null,"那么我们使用起来就很简单了，此时我们修改actions.js"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," axios ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'axios'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"*")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"as")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"T")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'./actionTypes'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"changeBtnText")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"text"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    type",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"T"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token constant"},"CHANGE_BTN_TEXT"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n    payload",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," text\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"changeBtnTextAsync")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"text"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"dispatch",Object(s.b)("span",{parentName:"span",className:"token punctuation"},",")," getState"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token operator"},"!"),Object(s.b)("span",{parentName:"code",className:"token function"},"getState"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"isLoading",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token function"},"dispatch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token function"},"changeBtnText"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},"'正在加载中'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    axios",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"get"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token template-string"},Object(s.b)("span",{parentName:"span",className:"token template-punctuation string"},"`"),Object(s.b)("span",{parentName:"span",className:"token string"},"http://test.com/"),Object(s.b)("span",{parentName:"span",className:"token interpolation"},Object(s.b)("span",{parentName:"span",className:"token interpolation-punctuation punctuation"},"${"),"text",Object(s.b)("span",{parentName:"span",className:"token interpolation-punctuation punctuation"},"}")),Object(s.b)("span",{parentName:"span",className:"token template-punctuation string"},"`")),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"then"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token function"},"getState"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"isLoading",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token function"},"dispatch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token function"},"changeBtnText"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},"'加载完毕'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"catch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token function"},"dispatch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token function"},"changeBtnText"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},"'加载有误'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"而原来mapDispatchToProps中的玩法和同步action的玩法是一样的："),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"mapDispatchToProps")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"dispatch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"changeText"),Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"text"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token function"},"dispatch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token function"},"changeBtnTextAsync"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"text",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"通过",Object(s.b)("inlineCode",{parentName:"p"},"redux-thunk"),"我们可以简单地进行异步操作，并且可以获取到各个异步操作时期状态的值。"),Object(s.b)("p",null,"redux-actions：简化redux的使用\nRedux虽然好用，但是里面还是有些重复代码，所以有了redux-actions来简化那些重复代码。"),Object(s.b)("p",null,"这部分简化工作主要集中在构造action和处理reducers方面。"),Object(s.b)("p",null,"先来看看原先的actions"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," axios ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'axios'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"*")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"as")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"T")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'./actionTypes'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"changeBtnText")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"text"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    type",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"T"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token constant"},"CHANGE_BTN_TEXT"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n    payload",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," text\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"changeBtnTextAsync")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"dispatch",Object(s.b)("span",{parentName:"span",className:"token punctuation"},",")," getState"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token operator"},"!"),Object(s.b)("span",{parentName:"code",className:"token function"},"getState"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"isLoading",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token function"},"dispatch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token function"},"changeBtnText"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},"'正在加载中'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    axios",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"get"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},"'http://test.com'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"then"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token function"},"getState"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"isLoading",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token function"},"dispatch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token function"},"changeBtnText"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},"'加载完毕'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"catch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token function"},"dispatch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token function"},"changeBtnText"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},"'加载有误'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"然后再来看看修改后的："),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," axios ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'axios'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"*")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"as")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"T")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'./actionTypes'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," createAction ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'redux-actions'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," changeBtnText ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"createAction"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token constant"},"T"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token constant"},"CHANGE_BTN_TEXT"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token parameter"},"text")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," text",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"changeBtnTextAsync")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"dispatch",Object(s.b)("span",{parentName:"span",className:"token punctuation"},",")," getState"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token operator"},"!"),Object(s.b)("span",{parentName:"code",className:"token function"},"getState"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"isLoading",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token function"},"dispatch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token function"},"changeBtnText"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},"'正在加载中'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    axios",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"get"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},"'http://test.com'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"then"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token function"},"getState"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"isLoading",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token function"},"dispatch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token function"},"changeBtnText"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},"'加载完毕'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"catch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token function"},"dispatch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token function"},"changeBtnText"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},"'加载有误'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"这一块代码替换上面的部分代码后，程序运行结果依然保持不变，也就是说createAction只是对上面的代码进行了简单的封装而已。"),Object(s.b)("p",null,"这里注意到，异步的action就不要用createAction，因为这个createAction返回的是一个对象，而不是一个函数，就会导致redux-thunk的代码没有起到作用。"),Object(s.b)("p",null,"这里也可以使用createActions这个函数同时创建多个action，但是讲道理，这个语法很奇怪，用createAction就好。"),Object(s.b)("p",null,"同样redux-actions对reducer的部分也进行了处理，比如handleAction以及handelActions。"),Object(s.b)("p",null,"先来看看原先的reducers"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"*")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"as")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"T")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'./actionTypes'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," initialState ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  btnText",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'我是按钮'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"pageMainReducer")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"state ",Object(s.b)("span",{parentName:"span",className:"token operator"},"=")," initialState",Object(s.b)("span",{parentName:"span",className:"token punctuation"},",")," action"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"switch")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"action",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"type",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"case")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"T"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token constant"},"CHANGE_BTN_TEXT"),Object(s.b)("span",{parentName:"code",className:"token operator"},":"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token operator"},"..."),"state",Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n        btnText",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," action",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"payload\n      ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"default"),Object(s.b)("span",{parentName:"code",className:"token operator"},":"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," state",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"default")," pageMainReducer",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"然后使用handleActions来处理"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," handleActions ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'redux-actions'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"*")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"as")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"T")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'./actionTypes'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," initialState ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  btnText",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'我是按钮'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," pageMainReducer ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"handleActions"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"["),Object(s.b)("span",{parentName:"code",className:"token constant"},"T"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token constant"},"CHANGE_BTN_TEXT"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"]"),Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function"},"next"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"state",Object(s.b)("span",{parentName:"span",className:"token punctuation"},",")," action"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token operator"},"..."),"state",Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n        btnText",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," action",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"payload",Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n      ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"throw"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"state",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," state",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," initialState",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"default")," pageMainReducer",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"这里",Object(s.b)("inlineCode",{parentName:"p"},"handleActions"),"可以加入异常处理，并且帮助处理了初始值。"),Object(s.b)("p",null,"注意，无论是",Object(s.b)("inlineCode",{parentName:"p"},"createAction"),"还是",Object(s.b)("inlineCode",{parentName:"p"},"handleAction"),"都只是对代码做了一点简单的封装，两者可以单独使用，并不是说使用了",Object(s.b)("inlineCode",{parentName:"p"},"createAction"),"就必须要用",Object(s.b)("inlineCode",{parentName:"p"},"handleAction"),"。"),Object(s.b)("p",null,Object(s.b)("inlineCode",{parentName:"p"},"redux-promise"),"：",Object(s.b)("inlineCode",{parentName:"p"},"redux-actions"),"的好基友，轻松创建和处理异步",Object(s.b)("inlineCode",{parentName:"p"},"action"),"\n还记得上面在使用",Object(s.b)("inlineCode",{parentName:"p"},"redux-actions"),"的",Object(s.b)("inlineCode",{parentName:"p"},"createAction"),"时，我们对异步的",Object(s.b)("inlineCode",{parentName:"p"},"action"),"无法处理。"),Object(s.b)("p",null,"因为我们使用",Object(s.b)("inlineCode",{parentName:"p"},"createAction"),"后返回的是一个对象，而不是一个函数，就会导致",Object(s.b)("inlineCode",{parentName:"p"},"redux-thunk"),"的代码没有起到作用。"),Object(s.b)("p",null,"而现在我们将使用",Object(s.b)("inlineCode",{parentName:"p"},"redux-promise"),"来处理这类情况。"),Object(s.b)("p",null,"可以看看之前我们使用 ",Object(s.b)("inlineCode",{parentName:"p"},"createAction"),"的例子："),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," changeBtnText ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"createAction"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token constant"},"T"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token constant"},"CHANGE_BTN_TEXT"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token parameter"},"text")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," text",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"现在我们先加入",Object(s.b)("inlineCode",{parentName:"p"},"redux-promise"),"中间件："),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," thunk ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'redux-thunk'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," createLogger ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'redux-logger'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," promiseMiddleware ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'redux-promise'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," reducer ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'./reducers'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," store ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"createStore"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"reducer",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"applyMiddleware"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"thunk",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," createLogger",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," promiseMiddleware",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"然后再处理异步action:"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," changeBtnTextAsync ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"createAction"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token constant"},"T"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token constant"},"CHANGE_BTN_TEXT_ASYNC"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"text"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," axios",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"get"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token template-string"},Object(s.b)("span",{parentName:"span",className:"token template-punctuation string"},"`"),Object(s.b)("span",{parentName:"span",className:"token string"},"http://test.com/"),Object(s.b)("span",{parentName:"span",className:"token interpolation"},Object(s.b)("span",{parentName:"span",className:"token interpolation-punctuation punctuation"},"${"),"text",Object(s.b)("span",{parentName:"span",className:"token interpolation-punctuation punctuation"},"}")),Object(s.b)("span",{parentName:"span",className:"token template-punctuation string"},"`")),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"可以看到我们这里返回的是一个Promise对象.(axios的get方法结果就是Promise对象)"),Object(s.b)("p",null,"我们还记得redux-thunk中间件，它会去判断action是否是一个函数，如果是就执行。"),Object(s.b)("p",null,"而我们这里的redux-promise中间件，他会在dispatch时，判断如果action不是类似"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"json"},Object(s.b)("pre",{parentName:"div",className:"language-json"},Object(s.b)("code",{parentName:"pre",className:"language-json"},Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  type：''",Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n  payload： ''\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")))),Object(s.b)("p",null,"这样的结构，也就是 FSA,那么就去判断是否为promise对象，如果是就执行action.then的玩法。"),Object(s.b)("p",null,"很明显，我们createAction后的结果是FSA，所以会走下面这个分支，它会去判断action.payload是否为promise对象，是的话那就"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},"action",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"payload\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"then"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"result")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"dispatch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"..."),"action",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," payload",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," result ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"catch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"error")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function"},"dispatch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"..."),"action",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," payload",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," error",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," error",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token boolean"},"true")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," Promise",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"reject"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"error",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")))),Object(s.b)("p",null,"也就是说我们的代码最后会转变为："),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},"axios",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"get"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token template-string"},Object(s.b)("span",{parentName:"span",className:"token template-punctuation string"},"`"),Object(s.b)("span",{parentName:"span",className:"token string"},"http://test.com/"),Object(s.b)("span",{parentName:"span",className:"token interpolation"},Object(s.b)("span",{parentName:"span",className:"token interpolation-punctuation punctuation"},"${"),"text",Object(s.b)("span",{parentName:"span",className:"token interpolation-punctuation punctuation"},"}")),Object(s.b)("span",{parentName:"span",className:"token template-punctuation string"},"`")),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"then"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"result")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"dispatch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"..."),"action",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," payload",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," result ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"catch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"error")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function"},"dispatch"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"..."),"action",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," payload",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," error",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," error",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token boolean"},"true")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," Promise",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"reject"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"error",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")))),Object(s.b)("p",null,"这个中间件的代码也很简单，总共19行，大家可以在github上直接看看。"),Object(s.b)("p",null,"redux-sage：控制器与更优雅的异步处理\n我们的异步处理用的是redux-thunk + redux-actions + redux-promise，其实用起来还是蛮好用的。"),Object(s.b)("p",null,"但是随着ES6中Generator的出现，人们发现用Generator处理异步可以更简单。"),Object(s.b)("p",null,"而redux-sage就是用Generator来处理异步。"),Object(s.b)("p",null,"以下讲的知识是基于Generator的，如果您对这个不甚了解，可以简单了解一下相关知识，大概需要2分钟时间，并不难。"),Object(s.b)("p",null,"redux-sage文档并没有说自己是处理异步的工具，而是说用来处理边际效应（side effects），这里的边际效应你可以理解为程序对外部的操作，比如请求后端，比如操作文件。"),Object(s.b)("p",null,"redux-sage同样是一个redux中间件，它的定位就是通过集中控制action，起到一个类似于MVC中控制器的效果。"),Object(s.b)("p",null,"同时它的语法使得复杂异步操作不会像promise那样出现很多then的情况，更容易进行各类测试。"),Object(s.b)("p",null,"这个东西有它的好处，同样也有它不好的地方，那就是比较复杂，有一定的学习成本。"),Object(s.b)("p",null,"并且我个人而言很不习惯Generator的用法，觉得Promise或者await更好用。"),Object(s.b)("p",null,"这里还是记录一下用法，毕竟有很多框架都用到了这个。"),Object(s.b)("p",null,"应用这个中间件和我们的其他中间件没有区别："),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," React ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'react'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," createStore",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," applyMiddleware ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'redux'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," promiseMiddleware ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'redux-promise'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," createSagaMiddleware ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'redux-saga'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"watchDelayChangeBtnText",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'./sagas'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," reducer ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'./reducers'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," sagaMiddleware ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"createSagaMiddleware"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," store ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"createStore"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"reducer",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"applyMiddleware"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"promiseMiddleware",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," sagaMiddleware",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\nsagaMiddleware",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"run"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"watchDelayChangeBtnText",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"创建sage中间件后，然后再将其中间件接入到store中,最后需要用中间件运行sages.js返回的Generator,监控各个action。"),Object(s.b)("p",null,"现在我们给出sages.js的代码："),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," delay ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'redux-saga'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," put",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," call",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," takeEvery ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'redux-saga/effects'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"*")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"as")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"T")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'./components/pageMain/actionTypes'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," changeBtnText ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'./components/pageMain/actions'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"consoleMsg")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"msg"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"info"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"msg",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"/**\n * 处理编辑效应的函数\n */"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function"),Object(s.b)("span",{parentName:"code",className:"token operator"},"*")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"delayChangeBtnText"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"yield")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"delay"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"1000"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"yield")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"put"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token function"},"changeBtnText"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},"'123'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"yield")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"call"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"consoleMsg",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'完成改变'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"/**\n * 监控Action的函数\n */"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function"),Object(s.b)("span",{parentName:"code",className:"token operator"},"*")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"watchDelayChangeBtnText"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"yield")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"takeEvery"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token constant"},"T"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token constant"},"WATCH_CHANGE_BTN_TEXT"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," delayChangeBtnText",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")))),Object(s.b)("p",null,"在redux-sage中有一类用来处理边际效应的函数比如put、call，它们的作用是为了简化操作。"),Object(s.b)("p",null,"比如put相当于redux的dispatch的作用，而call相当于调用函数。（可以参考上面代码中的例子）"),Object(s.b)("p",null,"还有另一类函数就是类似于takeEvery，它的作用就是和普通redux中间件一样拦截到action后作出相应处理。"),Object(s.b)("p",null,"比如上面的代码就是拦截到T.WATCH_CHANGE_BTN_TEXT这个类型的action，然后调用delayChangeBtnText。"),Object(s.b)("p",null,"然后可以回看我们之前的代码，有这么一行代码："),Object(s.b)("p",null,Object(s.b)("inlineCode",{parentName:"p"},"sagaMiddleware.run(watchDelayChangeBtnText)"),";"),Object(s.b)("p",null,"这里实际就是引入监控的这个生成器后，再运行监控生成器。"),Object(s.b)("p",null,"这样我们在代码里面dispatch类型为T.WATCH_CHANGE_BTN_TEXT的action时就会被拦截然后做出相应处理。"),Object(s.b)("p",null,"当然这里有人可能会提出疑问，难道每一个异步都要这么写吗，那岂不是要run很多次？"),Object(s.b)("p",null,"当然不是这个样子，我们可以在sage中这么写："),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"default")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function"),Object(s.b)("span",{parentName:"code",className:"token operator"},"*")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"rootSaga"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"yield")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"["),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function"},"watchDelayChangeBtnText"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"，\n    ",Object(s.b)("span",{parentName:"code",className:"token function"},"watchOtherAction"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"]"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")))),Object(s.b)("p",null,"我们只需要按照这个格式去写，将watchDelayChangeBtnText这样用于监控action的生成器放在上面那个代码的数组中，然后作为一个生成器返回。"),Object(s.b)("p",null,"现在只需要引用这个rootSaga即可，然后run这个rootSaga。"),Object(s.b)("p",null,"以后如果要监控更多的action，只需要在sages.js中加上新的监控的生成器即可。"),Object(s.b)("p",null,"通过这样的处理，我们就将sages.js做成了一个像MVC中的控制器的东西，可以用来处理各种各样的action，处理复杂的异步操作和边际效应。"),Object(s.b)("p",null,"但是这里要注意,一定要加以区分sages.js中使用监控的action和真正功能用的action，比如加个watch关键字，以免业务复杂后代码混乱。"),Object(s.b)("p",null,"总结\n总的来说："),Object(s.b)("ol",null,Object(s.b)("li",{parentName:"ol",className:"__internal"},"redux是一个可预测的状态容器，"),Object(s.b)("li",{parentName:"ol",className:"__internal"},"react-redux是将store和react结合起来，使得数据展示和修改对于react项目而言更简单"),Object(s.b)("li",{parentName:"ol",className:"__internal"},"redux中间件就是在dispatch action前对action做一些处理"),Object(s.b)("li",{parentName:"ol",className:"__internal"},"redux-thunk用于对异步做操作"),Object(s.b)("li",{parentName:"ol",className:"__internal"},"redux-actions用于简化redux操作"),Object(s.b)("li",{parentName:"ol",className:"__internal"},"redux-promise可以配合redux-actions用来处理Promise对象，使得异步操作更简单"),Object(s.b)("li",{parentName:"ol",className:"__internal"},"redux-sage可以起到一个控制器的作用，集中处理边际效用，并使得异步操作的写法更优雅。")))}d.isMDXComponent=!0,d=Object(c.hot)(e)(d),(m="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(m.register(r,"makeShortcode","E:\\h-project\\my-blog\\docs\\notes\\2021-07-03.md"),m.register(u,"Footer","E:\\h-project\\my-blog\\docs\\notes\\2021-07-03.md"),m.register(l,"layoutProps","E:\\h-project\\my-blog\\docs\\notes\\2021-07-03.md"),m.register("wrapper","MDXLayout","E:\\h-project\\my-blog\\docs\\notes\\2021-07-03.md"),m.register(d,"MDXContent","E:\\h-project\\my-blog\\docs\\notes\\2021-07-03.md")),(N="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&N(e)}.call(this,t(5)(e))}}]);