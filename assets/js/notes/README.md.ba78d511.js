(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{320:function(e,a,n){"use strict";n.r(a),function(e){n.d(a,"default",(function(){return k}));var t,c=n(107),s=(n(304),n(0),n(108)),p=["components"];function o(){return(o=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,arguments)}function b(e,a){if(null==e)return{};var n,t,c=function(e,a){if(null==e)return{};var n,t,c={},s=Object.keys(e);for(t=0;t<s.length;t++)n=s[t],a.indexOf(n)>=0||(c[n]=e[n]);return c}(e,a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(t=0;t<s.length;t++)n=s[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}(t="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&t(e);"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;var m,N,r=function(e){return function(a){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(s.b)("div",a)}},l=r("Footer"),u=r("ImageWrap"),i=r("FunButtonOne"),j=r("ClassButtonOne"),O={};function k(e){var a=e.components,n=b(e,p);return Object(s.b)("wrapper",o({},O,n,{components:a,mdxType:"MDXLayout"}),Object(s.b)("blockquote",null,Object(s.b)(l,{mdxType:"Footer"})),Object(s.b)("h1",{className:"__internal",id:"1关于react"},"1.关于React",Object(s.b)("a",{parentName:"h1",href:"#1%E5%85%B3%E4%BA%8Ereact","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("h2",{className:"__internal",id:"11-react是什么"},"1.1 React是什么",Object(s.b)("a",{parentName:"h2",href:"#11-react%E6%98%AF%E4%BB%80%E4%B9%88","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("inlineCode",{parentName:"li"},"React"),"是一个用于构建用户界面的 ",Object(s.b)("inlineCode",{parentName:"li"},"JavaScript")," 库。(",Object(s.b)("inlineCode",{parentName:"li"},"jquery"),"也是一个库，",Object(s.b)("inlineCode",{parentName:"li"},"angularjs"),"是一个框架)")),Object(s.b)("h2",{className:"__internal",id:"12-react能干什么"},"1.2 React能干什么",Object(s.b)("a",{parentName:"h2",href:"#12-react%E8%83%BD%E5%B9%B2%E4%BB%80%E4%B9%88","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul",className:"__internal"},"可以通过组件化的方法构建,构建快速响应的大型",Object(s.b)("inlineCode",{parentName:"li"},"web"),"应用")),Object(s.b)("h2",{className:"__internal",id:"13-react是如何干的"},"1.3 React是如何干的",Object(s.b)("a",{parentName:"h2",href:"#13-react%E6%98%AF%E5%A6%82%E4%BD%95%E5%B9%B2%E7%9A%84","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("h3",{className:"__internal",id:"131-声明式"},"1.3.1 声明式",Object(s.b)("a",{parentName:"h3",href:"#131-%E5%A3%B0%E6%98%8E%E5%BC%8F","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("strong",{parentName:"li"},"声明式"),"\n使用式编写用户界面，代码可行、方便调试。只需要告诉程序我想要的，其他的交给给",Object(s.b)("inlineCode",{parentName:"li"},"render"))),Object(s.b)("div",{className:"rcpress-highlight","data-language":"jsx"},Object(s.b)("pre",{parentName:"div",className:"language-jsx"},Object(s.b)("code",{parentName:"pre",className:"language-jsx"},"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," React ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"react"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ReactDOM ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from"),' "react',Object(s.b)("span",{parentName:"code",className:"token operator"},"-"),"dom\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," root ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," document",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"getElementById"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"root"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 声明式"),"\nReactDOM",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"render"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"div")," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"onClick"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"span",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"span",className:"token operator"},"=>"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),"\n  console",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"span",className:"token function"},"log"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"span",className:"token string"},'"声明式"'),Object(s.b)("span",{parentName:"span",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}")),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"声明式"),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"div"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"root",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n"))),Object(s.b)("p",null,"astexplorer.net"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("strong",{parentName:"li"},"命令式"),"\n类似面向过程,一步一步执行")),Object(s.b)("div",{className:"rcpress-highlight","data-language":"jsx"},Object(s.b)("pre",{parentName:"div",className:"language-jsx"},Object(s.b)("code",{parentName:"pre",className:"language-jsx"},"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 命令式"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," divEle ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," document",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"createElement"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"div"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\ndivEle",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"innerHTML ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"命令式"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\ndivEle",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"addEventListener"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"click"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token operator"},"=>"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n   console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"命令式"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\nroot",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"appendChild"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"divEle",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n"))),Object(s.b)("h3",{className:"__internal",id:"132-组件化"},"1.3.2 组件化",Object(s.b)("a",{parentName:"h3",href:"#132-%E7%BB%84%E4%BB%B6%E5%8C%96","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("p",null,"组件化 把页面可以拆分为一个一个组件，方便视图的拆分和复用，还可以做到高内聚和低耦合"),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},"可以使用",Object(s.b)("inlineCode",{parentName:"p"},"React"),"开发我们的",Object(s.b)("inlineCode",{parentName:"p"},"Web"),",",Object(s.b)("inlineCode",{parentName:"p"},"Native"),",",Object(s.b)("inlineCode",{parentName:"p"},"VR"),",命令行程序")),Object(s.b)("h3",{className:"__internal",id:"133-优缺点"},"1.3.3 优缺点",Object(s.b)("a",{parentName:"h3",href:"#133-%E4%BC%98%E7%BC%BA%E7%82%B9","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("p",{parentName:"li"},"优点"),Object(s.b)("ol",{parentName:"li"},Object(s.b)("li",{parentName:"ol",className:"__internal"},"开发团队与社区强大，有很多的组件、案例(有足够多的轮子)。"),Object(s.b)("li",{parentName:"ol",className:"__internal"},Object(s.b)("inlineCode",{parentName:"li"},"API"),"简洁。"),Object(s.b)("li",{parentName:"ol",className:"__internal"},"可以多处复用。"),Object(s.b)("li",{parentName:"ol",className:"__internal"},"声明式的写法,可以我们的代码结构清晰和整洁，可读性强。结构、样式和事件等能够实现高内聚底耦合，方便复用和组合。"),Object(s.b)("li",{parentName:"ol",className:"__internal"},"没有什么新的概念和语法，和以前写js基上是一至的。"))),Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("p",{parentName:"li"},"缺点"),Object(s.b)("ol",{parentName:"li"},Object(s.b)("li",{parentName:"ol",className:"__internal"},"官方没有成套的系统解决方案，社区的方案是百花齐放，从项目技术选型上来成本有点高。"),Object(s.b)("li",{parentName:"ol",className:"__internal"},"灵活性太高，对于写出高质量应用要求高,对于新手不友好有上手难度。")))),Object(s.b)("h3",{className:"__internal",id:"134-什么jsx"},"1.3.4 什么JSX",Object(s.b)("a",{parentName:"h3",href:"#134-%E4%BB%80%E4%B9%88jsx","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("div",{className:"rcpress-highlight","data-language":"jsx"},Object(s.b)("pre",{parentName:"div",className:"language-jsx"},Object(s.b)("code",{parentName:"pre",className:"language-jsx"},Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"h1"),"\n  ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"onClick"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"span",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"span",className:"token operator"},"=>"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),"\n  console",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"span",className:"token function"},"log"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"span",className:"token string"},'"!231"'),Object(s.b)("span",{parentName:"span",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}")),"\n  ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"style"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),"\n  width",Object(s.b)("span",{parentName:"span",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"span",className:"token number"},"100"),"\n  ",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}")),"\n  ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"id"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"test",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"')),"\n  ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"className"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"ok",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"')),"\n  ",Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n  hello react\n"),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"h1"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">"))))),Object(s.b)("hr",null),Object(s.b)("p",null," 在",Object(s.b)("a",{parentName:"p",href:"https://www.babeljs.cn/repl#?browsers=defaults%2C%20not%20ie%2011%2C%20not%20ie_mob%2011&build=&builtIns=false&corejs=3.6&spec=false&loose=false&code_lz=DwCwjABAUBEPYDsDCAbAlgYwNYF4DeAFAJQ4B8eMEGiAznCgKYB0KcA5gQEQCEATAMxhORANyUAvuOiwaAFwCejfBVgB3NABNZIAFwQwABgMSplTTk6yGcztKooAhjRoA5BwFsGFuFk6VSlCAMKKwQAE4MDhiyUMAA9OCkAJBAA&debug=false&forceAllTransforms=false&shippedProposals=false&circleciRepo=&evaluate=false&fileSize=false&timeTravel=false&sourceType=module&lineWrap=true&presets=env%2Creact%2Cstage-2&prettier=false&targets=&version=7.14.7&externalPlugins=",target:"_blank"},"babel"),"进行转义后的结果(",Object(s.b)("a",{parentName:"p",href:"https://esprima.org/demo/parse.html#",target:"_blank"},"AST"),"语法树转义，参考这里",Object(s.b)("a",{parentName:"p",href:"https://astexplorer.net/",target:"_blank"},"astexplorer"),")"),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},"tips: ",Object(s.b)("inlineCode",{parentName:"p"},"ast"),"是用于描述语法的，而",Object(s.b)("inlineCode",{parentName:"p"},"vnode"),"是描述界面")),Object(s.b)("hr",null),Object(s.b)("div",{className:"rcpress-highlight","data-language":"jsx"},Object(s.b)("pre",{parentName:"div",className:"language-jsx"},Object(s.b)("code",{parentName:"pre",className:"language-jsx"},Object(s.b)("span",{parentName:"code",className:"token string"},'"use strict"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"/*#__PURE__*/"),"\n",Object(s.b)("span",{parentName:"code",className:"token string"},'"use strict"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"/*#__PURE__*/"),"\nReact",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"createElement"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"h1"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"onClick"),Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"!231"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n  style",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    width",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"100"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n  id",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"test"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n  className",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"ok"'),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"hello react"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("inlineCode",{parentName:"li"},"JSX"),"是",Object(s.b)("inlineCode",{parentName:"li"},"javascript"),"的扩展，",Object(s.b)("inlineCode",{parentName:"li"},"JSX"),"可以很好的描述UI应该呈现出它应该有交互的本质形式."),Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("inlineCode",{parentName:"li"},"JSX"),"本质是 ",Object(s.b)("inlineCode",{parentName:"li"},"React.createElement"),"的语法糖")),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"补充",Object(s.b)("inlineCode",{parentName:"strong"},"React 17"),"以后创建组件的本质是引入一个",Object(s.b)("inlineCode",{parentName:"strong"},"jsx/runtime"),",其实就",Object(s.b)("inlineCode",{parentName:"strong"},"jsx/runtime"),"封装了",Object(s.b)("inlineCode",{parentName:"strong"},"React.createElement()"))),Object(s.b)("div",{className:"rcpress-highlight","data-language":"jsx"},Object(s.b)("pre",{parentName:"div",className:"language-jsx"},Object(s.b)("code",{parentName:"pre",className:"language-jsx"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," sourceCode ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token template-string"},Object(s.b)("span",{parentName:"span",className:"token template-punctuation string"},"`"),Object(s.b)("span",{parentName:"span",className:"token string"},'<h1 onClick={()=>{ console.log("!231"); }} style={{ width: 100 }} id="test" className="ok" > hello react </h1>'),Object(s.b)("span",{parentName:"span",className:"token template-punctuation string"},"`")),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," babel ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"require"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"@babel/core"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," result ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," babel",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"transform"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"sourceCode",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    plugins",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"["),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"["),Object(s.b)("span",{parentName:"code",className:"token string"},'"@babel/plugin-transform-react-jsx"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," runtime",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"classic"')," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"]"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"]")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// classic automatic"),"\n"))),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("strong",{parentName:"li"},"classic")," 模式下结果:")),Object(s.b)("div",{className:"rcpress-highlight","data-language":"jsx"},Object(s.b)("pre",{parentName:"div",className:"language-jsx"},Object(s.b)("code",{parentName:"pre",className:"language-jsx"},Object(s.b)("span",{parentName:"code",className:"token comment"},"/*#__PURE__*/"),"\nReact",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"createElement"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"h1"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"onClick"),Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"!231"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n  style",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    width",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"100"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n  id",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"test"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n  className",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"ok"'),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'" hello react "'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("strong",{parentName:"li"},"automatic")," 模式下结果:")),Object(s.b)("div",{className:"rcpress-highlight","data-language":"jsx"},Object(s.b)("pre",{parentName:"div",className:"language-jsx"},Object(s.b)("code",{parentName:"pre",className:"language-jsx"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," jsx ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"as")," _jsx ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"react/jsx-runtime"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"/*#__PURE__*/"),"\n",Object(s.b)("span",{parentName:"code",className:"token function"},"_jsx"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"h1"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"onClick"),Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"!231"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n  style",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    width",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"100"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n  id",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"test"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n  className",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"ok"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n  children",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'" hello react "'),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("h3",{className:"__internal",id:"135-关于virtualdom"},"1.3.5 关于virtualDOM",Object(s.b)("a",{parentName:"h3",href:"#135-%E5%85%B3%E4%BA%8Evirtualdom","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("div",{className:"rcpress-highlight","data-language":"jsx"},Object(s.b)("pre",{parentName:"div",className:"language-jsx"},Object(s.b)("code",{parentName:"pre",className:"language-jsx"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," React ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"react"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," virtualDOMOne ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"\n    ",Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"div")," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"id"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"A",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"key"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"A",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"')),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n        "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"div")," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"id"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"B",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"key"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"B",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"')),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n            B\n        "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"div"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n        "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"div")," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"id"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"C",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"key"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"C",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"')),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n            C\n        "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"div"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n    "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"div"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," virtualDOMTwo ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," React",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"createElement"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"\n    ",Object(s.b)("span",{parentName:"code",className:"token string"},'"div"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," id",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"A"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," key",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"A"')," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n    React",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"createElement"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"div"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," id",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"B"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," key",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"B"')," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n    React",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"createElement"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"div"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," id",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"C"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," key",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"C"')," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n"))),Object(s.b)("p",null,"打印结果:"),Object(s.b)(u,{title:"虚拟dom",desc:"虚拟dom的输出接口",src:"/images/react-dom-1.png",mdxType:"ImageWrap"}),Object(s.b)("p",null,"简单的实现我们",Object(s.b)("inlineCode",{parentName:"p"},"React.createElement()")),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},"tips: 为啥这里不使用箭头函数")),Object(s.b)("div",{className:"rcpress-highlight","data-language":"jsx"},Object(s.b)("pre",{parentName:"div",className:"language-jsx"},Object(s.b)("code",{parentName:"pre",className:"language-jsx"},"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"/**\n *\n * @param {*} type 元素类型\n * @param {*} config 配置对象\n * @param {*} children 子类\n */"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 保留属性"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"RESERVED_PROPS")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    key",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token boolean"},"true"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n    ref",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token boolean"},"true"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n    __self",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token boolean"},"true"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n    __source",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token boolean"},"true"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," sbl ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"Symbol"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"1232"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 特定的值 可以react的源码中查看"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"createElement"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"type",Object(s.b)("span",{parentName:"span",className:"token punctuation"},",")," config",Object(s.b)("span",{parentName:"span",className:"token punctuation"},",")," children"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," props ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// key用来标识每个固定元素 注意这个key写 不会自动生成或是加一个去一个key"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," key ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"null"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 在dom-diff的时候会通过索引来进行比较"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"config ",Object(s.b)("span",{parentName:"code",className:"token operator"},"!==")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"null"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        key ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," config",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"key",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"for")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," propsName ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"in")," config",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token operator"},"!"),Object(s.b)("span",{parentName:"code",className:"token constant"},"RESERVED_PROPS"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"hasOwnProperty"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"propsName",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            props",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"["),"propsName",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"]")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," config",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"["),"propsName",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"]"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token comment"},"/*\n     * children\n     * 有可能是一个元素，也有可能是一个字符串，也有可能是一个数字，也有可能是Null\n     * 也有可能只有一个儿子，也有可能没有儿子或是多个儿子\n     * props.children = null|string|number|React元素 [null|string|number|React元素 ]\n     * ReactNode 与 ReactElement\n     * ReactNode 标识一个可以渲染的值 null|string|number|React // 相当于类型\n     */"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," childrenLength ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," arguments",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"length ",Object(s.b)("span",{parentName:"code",className:"token operator"},"-")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"2"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"childrenLength ",Object(s.b)("span",{parentName:"code",className:"token operator"},"===")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        props",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"children ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," children",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"else")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"childrenLength ",Object(s.b)("span",{parentName:"code",className:"token operator"},">")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," childArray ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"Array"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"childrenLength",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"for")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," i ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"0"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," i ",Object(s.b)("span",{parentName:"code",className:"token operator"},"<")," childrenLength",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," i",Object(s.b)("span",{parentName:"code",className:"token operator"},"++"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            childArray",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"["),"i",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"]")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," arguments",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"["),"i ",Object(s.b)("span",{parentName:"code",className:"token operator"},"+")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"2"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"]"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        props",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"children ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," childArray",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n    ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// React.createElement方法返回是一个普通的js对象，用于描述我们的元素，这里可以简单理解这就是我们的虚拟DOM,"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 从这里看出虚拟DOM是可以跨平台的"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," element ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        $$",Object(s.b)("span",{parentName:"code",className:"token keyword"},"typeof"),Object(s.b)("span",{parentName:"code",className:"token operator"},":")," sbl",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 标识符 用于标识是一个react元素"),"\n        type",Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n        key",Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n        props\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," element",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n"))),Object(s.b)("p",null,"总结一下:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul",className:"__internal"},"避免操作真实的",Object(s.b)("inlineCode",{parentName:"li"},"DOM"),"，又麻烦又容易出错"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"内容经过了",Object(s.b)("inlineCode",{parentName:"li"},"XSS"),"处理,可以防范",Object(s.b)("inlineCode",{parentName:"li"},"xss"),"攻击"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"比较容易实现跨平台"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"更新的时候可以实现差异化更新,减少了",Object(s.b)("inlineCode",{parentName:"li"},"DOM"),"的操作(",Object(s.b)("inlineCode",{parentName:"li"},"innerhtml"),"也可以实现我们精准更新，但是需要手动操作)"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"因为虚拟",Object(s.b)("inlineCode",{parentName:"li"},"DOM"),"是纯",Object(s.b)("inlineCode",{parentName:"li"},"JS"),"对象，所以会需要消耗额外的内存(在完成渲染之后",Object(s.b)("inlineCode",{parentName:"li"},"V-DOM"),"会释放内存)"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"首次渲染不会很快(",Object(s.b)("em",{parentName:"li"},"怎么处理首次渲染白屏的问题"),")")),Object(s.b)("h2",{className:"__internal",id:"14-类组件与函数组件"},"1.4 类组件与函数组件",Object(s.b)("a",{parentName:"h2",href:"#14-%E7%B1%BB%E7%BB%84%E4%BB%B6%E4%B8%8E%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},"在源码里面如何区分一个组件为类组件还是函数组件，\n只需要查看是否具有属性",Object(s.b)("inlineCode",{parentName:"p"},"isReactComponent"))),Object(s.b)("p",null,"如:"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"jsx"},Object(s.b)("pre",{parentName:"div",className:"language-jsx"},Object(s.b)("code",{parentName:"pre",className:"language-jsx"},"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// isReactComponent 做为判断属性"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"RComponent"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"props ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," prpos",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"div"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"div"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token class-name"},"RComponent"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"prototype",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"isReactComponent ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"class")," ",Object(s.b)("span",{parentName:"code",className:"token class-name"},"RCComponent")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"static")," isReactComponent ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token boolean"},"true"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function"},"constructor"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"props"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"props ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," props",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function"},"render"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"div"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"div"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")))),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("p",{parentName:"li"},"相同点:"),Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul",className:"__internal"},"它们都可以接收属性并都可以反回",Object(s.b)("inlineCode",{parentName:"li"},"React"),"元素"))),Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("p",{parentName:"li"},"不同点:"),Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul",className:"__internal"},"编程思想不同： 类组件需要创建实例，是基于面向对象的方式。而函数式组件不需要创建实例，接收输入，返回输出，是基本函数式的方式。"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"内存占用：类组件需要创建并保存实例(渲染之后类的实例还会存，不会销毁。还需要进行更新)，会占用一定的内存，而函数组件不需要创建实例，可以节约内存。"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"捕获特性：函数组件可以捕获值异常。"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"易测性：函数组件很容易编写单元测试。"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"状态：类组件的状态使用",Object(s.b)("inlineCode",{parentName:"li"},"this.setState"),"修改或是更新状态,函数组件使用的",Object(s.b)("inlineCode",{parentName:"li"},"useState"),"更新状态。"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"关于this：在函数组件当中可以更好的屏蔽",Object(s.b)("inlineCode",{parentName:"li"},"this"),"的问题，规范和复用逻辑，更好的适合时间分片与并发渲染。"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"生命周期：类组件具有完成的生命周期，函数组件当中使用",Object(s.b)("inlineCode",{parentName:"li"},"useEffect"),"实例类似的生命同期。类组件可以通过",Object(s.b)("inlineCode",{parentName:"li"},"shouldComponentUpdate"),"与",Object(s.b)("inlineCode",{parentName:"li"},"PureComponent"),"跳过更新，函数组件使用",Object(s.b)("inlineCode",{parentName:"li"},"React.mome"),"来缓存跳过更新(使用",Object(s.b)("inlineCode",{parentName:"li"},"immuertablejs"),"或",Object(s.b)("inlineCode",{parentName:"li"},"immer"),"做深比较)。")))),Object(s.b)("hr",null),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("p",{parentName:"li"},"函数式组件:"),Object(s.b)("blockquote",{parentName:"li"},Object(s.b)("p",{parentName:"blockquote"},"捕获特性：函数组件可以捕获值异常。")))),Object(s.b)("div",{className:"rcpress-highlight","data-language":"jsx"},Object(s.b)("pre",{parentName:"div",className:"language-jsx"},Object(s.b)("code",{parentName:"pre",className:"language-jsx"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"FunButtonOne")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"["),"num",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," setNum",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"]")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"useState"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"0"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"handleClick")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token function"},"setTimeout"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"num",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 0 闭包"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"3000"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token function"},"setNum"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"num ",Object(s.b)("span",{parentName:"code",className:"token operator"},"+")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),Object(s.b)("span",{parentName:"span",className:"token class-name"},"Button"))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"onClick"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),"handleClick",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}")),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"函数式组件("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"num",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token plain-text"},")"),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),Object(s.b)("span",{parentName:"span",className:"token class-name"},"Button")),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n"))),Object(s.b)(i,{mdxType:"FunButtonOne"}),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul",className:"__internal"},"类组件:")),Object(s.b)("div",{className:"rcpress-highlight","data-language":"jsx"},Object(s.b)("pre",{parentName:"div",className:"language-jsx"},Object(s.b)("code",{parentName:"pre",className:"language-jsx"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"class")," ",Object(s.b)("span",{parentName:"code",className:"token class-name"},"ClassButtonOne")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"extends")," ",Object(s.b)("span",{parentName:"code",className:"token class-name"},"Component")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    state ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        num",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"0"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"handleClick")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token function"},"setTimeout"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"state",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"num",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 1"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"3000"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"setState"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            num",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"state",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"num ",Object(s.b)("span",{parentName:"code",className:"token operator"},"+")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"1"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function"},"render"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),Object(s.b)("span",{parentName:"span",className:"token class-name"},"Button"))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"onClick"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),Object(s.b)("span",{parentName:"span",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"."),"handleClick",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}")),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"类组件("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),Object(s.b)("span",{parentName:"code",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"state",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"num",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token plain-text"},")"),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),Object(s.b)("span",{parentName:"span",className:"token class-name"},"Button")),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n"))),Object(s.b)(j,{mdxType:"ClassButtonOne"}),Object(s.b)("h2",{className:"__internal",id:"15-渲染流程"},"1.5 渲染流程",Object(s.b)("a",{parentName:"h2",href:"#15-%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("h3",{className:"__internal",id:"151-设计理念"},"1.5.1 设计理念",Object(s.b)("a",{parentName:"h3",href:"#151-%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul",className:"__internal"},"跨平台 => 虚拟DOM"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"快样响应 => 异步中短 + 增量更新"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"浏览器的刷新频率为60Hz,大概是16.6毫秒渲染一次，而js的线程与渲染线程是互斥的，所以如果JS线程执行任务时间超过16.6ms的话，就会导致掉帧，导致卡顿，",Object(s.b)("inlineCode",{parentName:"li"},"React"),"会利用空闲的时间进行更新，不会影响渲染进程的正常渲染。"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"时间切片,把耗时的任务切分成一个一个的小任务，分布在每一帧里进行处理(react默认大约每帧耗时5.5ms上下)")),Object(s.b)("div",{className:"rcpress-highlight","data-language":"jsx"},Object(s.b)("pre",{parentName:"div",className:"language-jsx"},Object(s.b)("code",{parentName:"pre",className:"language-jsx"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," React",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," Component ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"react"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"import")," ReactDOM ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"from")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"react-dom"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"export")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"class")," ",Object(s.b)("span",{parentName:"code",className:"token class-name"},"MoreList")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"extends")," ",Object(s.b)("span",{parentName:"code",className:"token class-name"},"Component")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    state ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        list",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"new")," ",Object(s.b)("span",{parentName:"code",className:"token class-name"},"Array"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"10000"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"fill"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"0"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"add")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"setState"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            list",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"["),Object(s.b)("span",{parentName:"code",className:"token operator"},"..."),Object(s.b)("span",{parentName:"code",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"state",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"list",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"]"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function"},"render"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"\n            ",Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"ul"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n                "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),Object(s.b)("span",{parentName:"span",className:"token class-name"},"Button"))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"onClick"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),Object(s.b)("span",{parentName:"span",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"."),"add",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}")),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"添加"),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),Object(s.b)("span",{parentName:"span",className:"token class-name"},"Button")),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n                "),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),Object(s.b)("span",{parentName:"code",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"state",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"list",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"map"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"v",Object(s.b)("span",{parentName:"span",className:"token punctuation"},",")," i"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"li")," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"key"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),"i",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}")),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"v ",Object(s.b)("span",{parentName:"code",className:"token operator"},"+")," i",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"li"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n                ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"-\n            "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"ul"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 同步渲染机制"),"\nReactDOM",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"render"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),Object(s.b)("span",{parentName:"span",className:"token class-name"},"MoreList"))," ",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"/>")),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," document",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"getElementById"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"root"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 异步渲染 实验版本 异步渲染会把总体执行时间变长"),"\nReactDOM",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"unstable_createRoot"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"document",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"getElementById"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"root"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"render"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),Object(s.b)("span",{parentName:"span",className:"token class-name"},"MoreList"))," ",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"/>")),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n"))),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},"补充:"),Object(s.b)("ol",{parentName:"blockquote"},Object(s.b)("li",{parentName:"ol",className:"__internal"},"大多数的设备的屏幕刷新频率为60次/秒"),Object(s.b)("li",{parentName:"ol",className:"__internal"},"浏览器的渲染动画或页面的每一帧速率也需要与设备屏幕的刷新率保持一致"),Object(s.b)("li",{parentName:"ol",className:"__internal"},"页面是一帧一帧渲染出来了，当每秒绘制的帧的帧数(FPS)达到60时，页面是流畅的，小于这个值时，用户会感觉到卡顿"),Object(s.b)("li",{parentName:"ol",className:"__internal"},"每一个帧的时间为16.6ms(1秒/60) 在进行代码处理时争取每一帧的工作量不超过16ms"),Object(s.b)("li",{parentName:"ol",className:"__internal"},"异步渲染会把总体执行时间变长"),Object(s.b)("li",{parentName:"ol",className:"__internal"},"如果执行耗时耗时较长的任务，进行分片处理是，任务的执行类似与端点续传"),Object(s.b)("li",{parentName:"ol",className:"__internal"},"官方默认还是为异步渲染")),Object(s.b)(u,{title:"绘制流程",src:"/images/anatomy-of-a-frame.jpg",mdxType:"ImageWrap"}),Object(s.b)("p",{parentName:"blockquote"},"浏览器并不需要执行所有步骤，具体情况取决于哪些步骤是必需的。例如，如果没有新的 ",Object(s.b)("inlineCode",{parentName:"p"},"HTML")," 要解析，那么解析 ",Object(s.b)("inlineCode",{parentName:"p"},"HTML")," 的步骤就不会触发。\n",Object(s.b)("inlineCode",{parentName:"p"},"RecalcStyles")," 和 ",Object(s.b)("inlineCode",{parentName:"p"},"Layout")," 下方指向 ",Object(s.b)("inlineCode",{parentName:"p"},"requestAnimationFrame")," 的红色箭头。在代码中恰好触发这两个情况是完全可能的。这种情况叫做强制同步布局（或强制同步样式，",Object(s.b)("inlineCode",{parentName:"p"},"Forced Synchronous Layout")," 和 ",Object(s.b)("inlineCode",{parentName:"p"},"Forced Synchronous Styles"),"）\n帧流程")),Object(s.b)("blockquote",null,Object(s.b)("blockquote",{parentName:"blockquote"},Object(s.b)("p",{parentName:"blockquote"},Object(s.b)("strong",{parentName:"p"},"每个帧的开头包哈样式计算、布局和绘制。"),"\n",Object(s.b)("strong",{parentName:"p"},Object(s.b)("inlineCode",{parentName:"strong"},"Javascript"),"引擎和页面渲染引擎在同一个渲染线程。",Object(s.b)("inlineCode",{parentName:"strong"},"GUI渲染和"),"Javascript`执行两者是互斥，如果某一个执行任务时间过长，浏览器会推迟渲染")),Object(s.b)(u,{title:"补充",desc:"帧的流程",src:"/images/z.png",mdxType:"ImageWrap"}),Object(s.b)("ol",{parentName:"blockquote"},Object(s.b)("li",{parentName:"ol",className:"__internal"},Object(s.b)("strong",{parentName:"li"},"开始新的一帧")," ",Object(s.b)("em",{parentName:"li"},"垂直同步信号触发，开始渲染新的一帧图像。")),Object(s.b)("li",{parentName:"ol",className:"__internal"},Object(s.b)("strong",{parentName:"li"},"输入事件的处理")," ",Object(s.b)("em",{parentName:"li"},"从合成线程将输入的数据，传递到主线程的事件处理函数。所有的事件处理函数（",Object(s.b)("inlineCode",{parentName:"em"},"touchmove"),"，",Object(s.b)("inlineCode",{parentName:"em"},"scroll"),"，",Object(s.b)("inlineCode",{parentName:"em"},"click"),"）都应该最先触发，每帧触发一次，但也不一定这样；调度程序会尽力尝试，但是是否真的每帧触发因操作系统而异。从用户交互事件，到事件被交付主线程，二者之间也存在延迟。")),Object(s.b)("li",{parentName:"ol",className:"__internal"},Object(s.b)("strong",{parentName:"li"},Object(s.b)("inlineCode",{parentName:"strong"},"requestAnimationFrame"))," ",Object(s.b)("em",{parentName:"li"},"这是更新屏幕显示内容的理想位置，因为现在有全新的输入数据，又非常接近即将到来的垂直同步信号。其他的可视化任务，比如样式计算，因为是在本次任务之后，所以现在是变更元素的理想位置。如果你改变了 —— 比如说 100 个类的样式，这不会引起 100 次样式计算；它们会在稍后被批量处理。唯一需要注意的是，不要查询进行计算才能得到的样式或者布局属性（比如 ",Object(s.b)("inlineCode",{parentName:"em"},"el.style.backgroundImage")," 或 ",Object(s.b)("inlineCode",{parentName:"em"},"el.style.offsetWidth"),"）。会导致重新计算样式，或者布局，或者二者都发生，进一步导致强制同步布局，乃至布局颠簸。")),Object(s.b)("li",{parentName:"ol",className:"__internal"},Object(s.b)("strong",{parentName:"li"},"解析 ",Object(s.b)("inlineCode",{parentName:"strong"},"HTML"),"（",Object(s.b)("inlineCode",{parentName:"strong"},"Parse HTML"),"）")," ",Object(s.b)("em",{parentName:"li"},"处理新添加的 ",Object(s.b)("inlineCode",{parentName:"em"},"HTML"),"，创建 ",Object(s.b)("inlineCode",{parentName:"em"},"DOM")," 元素。在页面加载过程中，或者进行 ",Object(s.b)("inlineCode",{parentName:"em"},"appendChild")," 操作后，你可能看到更多的此过程发生。")),Object(s.b)("li",{parentName:"ol",className:"__internal"},Object(s.b)("strong",{parentName:"li"},"重新计算样式（",Object(s.b)("inlineCode",{parentName:"strong"},"Recalc Styles"),"）")," ",Object(s.b)("em",{parentName:"li"},"为新添加或变更的内容计算样式。可能要计算整个 ",Object(s.b)("inlineCode",{parentName:"em"},"DOM")," 树，也可能缩小范围，取决于具体更改了什么。例如，更改 ",Object(s.b)("inlineCode",{parentName:"em"},"body")," 的类名影响可能很大，但是值得注意的是浏览器已经足够智能了，可以自动限制重新计算样式的范围。")),Object(s.b)("li",{parentName:"ol",className:"__internal"},Object(s.b)("strong",{parentName:"li"},"布局（",Object(s.b)("inlineCode",{parentName:"strong"},"Layout"),"）")," ",Object(s.b)("em",{parentName:"li"},"计算每个可见元素的几何信息（每个元素的位置和大小）。一般作用于整个文档，计算成本通常和 DOM 元素的大小成比例。")),Object(s.b)("li",{parentName:"ol",className:"__internal"},Object(s.b)("strong",{parentName:"li"},"更新图层树（",Object(s.b)("inlineCode",{parentName:"strong"},"Update Layer Tree"),"）")," ",Object(s.b)("em",{parentName:"li"},"这一步创建层叠上下文，为元素的深度进行排序。")),Object(s.b)("li",{parentName:"ol",className:"__internal"},Object(s.b)("strong",{parentName:"li"},Object(s.b)("inlineCode",{parentName:"strong"},"Paint"))," ",Object(s.b)("em",{parentName:"li"},"过程分为两步：第一步，对所有新加入的元素，或进行改变显示状态的元素，记录 ",Object(s.b)("inlineCode",{parentName:"em"},"draw")," 调用（这里填充矩形，那里写点字）；第二步是栅格化（",Object(s.b)("inlineCode",{parentName:"em"},"Rasterization"),"，见后文），在这一步实际执行了 ",Object(s.b)("inlineCode",{parentName:"em"},"draw")," 的调用，并进行纹理填充。",Object(s.b)("inlineCode",{parentName:"em"},"Paint")," 过程记录 ",Object(s.b)("inlineCode",{parentName:"em"},"draw")," 调用，一般比栅格化要快，但是两部分通常被统称为",Object(s.b)("inlineCode",{parentName:"em"},"painting"),"。")),Object(s.b)("li",{parentName:"ol",className:"__internal"},Object(s.b)("strong",{parentName:"li"},"合成（",Object(s.b)("inlineCode",{parentName:"strong"},"Composite"),"）")," ",Object(s.b)("em",{parentName:"li"},"图层和图块信息计算完成后，被传回合成线程进行处理。这将包括 ",Object(s.b)("inlineCode",{parentName:"em"},"will-change"),"、重叠元素和硬件加速的 ",Object(s.b)("inlineCode",{parentName:"em"},"canvas")," 等。")),Object(s.b)("li",{parentName:"ol",className:"__internal"},Object(s.b)("strong",{parentName:"li"},"栅格化规划（",Object(s.b)("inlineCode",{parentName:"strong"},"Raster Scheduled"),"）和栅格化（",Object(s.b)("inlineCode",{parentName:"strong"},"Rasterize"),"）")," ",Object(s.b)("em",{parentName:"li"},"在 ",Object(s.b)("inlineCode",{parentName:"em"},"Paint")," 任务中记录的 draw 调用现在执行。过程是在合成图块栅格化线程（",Object(s.b)("inlineCode",{parentName:"em"},"Compositor Tile Workers"),"）中进行，线程的数量取决于平台和设备性能。例如，在 ",Object(s.b)("inlineCode",{parentName:"em"},"Android")," 设备上，通常有一个线程，而在桌面设备上有时有 4 个。栅格化根据图层来完成，每层都被分成块。")),Object(s.b)("li",{parentName:"ol",className:"__internal"},Object(s.b)("strong",{parentName:"li"},"帧结束")," ",Object(s.b)("em",{parentName:"li"},"各个层的所有的块都被栅格化成位图后，新的块和输入数据（可能在事件处理程序中被更改过）被提交给 ",Object(s.b)("inlineCode",{parentName:"em"},"GPU"),"线程。")),Object(s.b)("li",{parentName:"ol",className:"__internal"},Object(s.b)("strong",{parentName:"li"},"发送帧")," ",Object(s.b)("em",{parentName:"li"},"最后，但同样很重要的是，图块被 ",Object(s.b)("inlineCode",{parentName:"em"},"GPU")," 线程上传到 ",Object(s.b)("inlineCode",{parentName:"em"},"GPU"),"。",Object(s.b)("inlineCode",{parentName:"em"},"GPU")," 使用四边形和矩阵（所有常用的 ",Object(s.b)("inlineCode",{parentName:"em"},"GL")," 数据类型）将图块 ",Object(s.b)("inlineCode",{parentName:"em"},"draw"),"在屏幕上。"))),Object(s.b)("p",{parentName:"blockquote"},"tips: ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("inlineCode",{parentName:"strong"},"requestIdleCallback"))," ",Object(s.b)("em",{parentName:"p"},"如果在帧结束时，主线程还有点时间，",Object(s.b)("inlineCode",{parentName:"em"},"requestIdleCallback")," 可能会被触发。这是做些非必要工作的好机会，比如标记分析数据。",Object(s.b)("inlineCode",{parentName:"em"},"requestIdleCallback"),"能够在主事件循环上执行后台和低优先级工作，而不会影响延迟关键事件，如动画和输入响应，正常帧任务完成后没有超过16ms,说明时间有富佘，此时就会执行",Object(s.b)("inlineCode",{parentName:"em"},"requestIdleCallback"),"里注册任务(最长可达到50ms)")),Object(s.b)("p",{parentName:"blockquote"},Object(s.b)("inlineCode",{parentName:"p"},"requestIdleCallback")," 存在",Object(s.b)("strong",{parentName:"p"},"兼容性"),"，",Object(s.b)("inlineCode",{parentName:"p"},"React"),"使用的是",Object(s.b)("inlineCode",{parentName:"p"},"MessageChannel + requestAnimationFrame")," 模拟一个",Object(s.b)("inlineCode",{parentName:"p"},"requestIdleCallback")))),Object(s.b)("blockquote",null,Object(s.b)("blockquote",{parentName:"blockquote"},Object(s.b)(u,{title:"requestIdleCallback",desc:"requestIdleCallback的空闲流程",src:"/images/requestIdleCallback.jpg",mdxType:"ImageWrap"}))),Object(s.b)("div",{className:"rcpress-highlight","data-language":"jsx"},Object(s.b)("pre",{parentName:"div",className:"language-jsx"},Object(s.b)("code",{parentName:"pre",className:"language-jsx"},"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"//  按序调用"),"\n",Object(s.b)("span",{parentName:"code",className:"token function"},"requestIdleCallback"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n",Object(s.b)("span",{parentName:"code",className:"token function"},"requestIdleCallback"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"2"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n",Object(s.b)("span",{parentName:"code",className:"token function"},"requestIdleCallback"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"3"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n",Object(s.b)("span",{parentName:"code",className:"token function"},"requestIdleCallback"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"4"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n",Object(s.b)("span",{parentName:"code",className:"token function"},"requestIdleCallback"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"5"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 1 2 3 4 5"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 队列"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," tasks ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"["),Object(s.b)("span",{parentName:"code",className:"token number"},"0"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"2"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"3"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"4"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"]"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"doLowProMissions")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"IdleDeadline"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 空闲时间内尽量多执行任务 IdleDeadline.timeRemaining() 可以拿到空闲时间"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"while")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"IdleDeadline",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"timeRemaining"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"&&")," tasks",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"length",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," num ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," tasks",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"shift"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n        console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},"'执行任务：'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," num",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 剩余任务下一个空闲段执行"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"tasks",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"length",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"requestIdleCallback"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"doLowProMissions",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token function"},"requestIdleCallback"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"doLowProMissions",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 执行任务： 0"),"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// ..."),"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 执行任务： 4"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 定义日志上报队列"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," reportTasks ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"["),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"]"),"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 按需填充日志队列"),"\nreportTasks",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"push"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"cmd",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"111"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," action",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"111"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\nreportTasks",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"push"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"cmd",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"222"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," action",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"222"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 回调函数"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"doLowPriorityReport")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"IdleDeadline"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 空闲时间内尽量多执行任务"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"while")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"IdleDeadline",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"timeRemaining"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"&&")," reportTasks",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"length",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," log ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," reportTasks",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"shift"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n        console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"日志"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," log",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 剩余任务下一个空闲段执行"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"reportTasks",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"length",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"requestIdleCallback"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"doLowPriorityReport",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token function"},"requestIdleCallback"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"doLowPriorityReport",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n"))),Object(s.b)("h3",{className:"__internal",id:"152-渲染步骤"},"1.5.2 渲染步骤",Object(s.b)("a",{parentName:"h3",href:"#152-%E6%B8%B2%E6%9F%93%E6%AD%A5%E9%AA%A4","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("p",{parentName:"li"},Object(s.b)("inlineCode",{parentName:"p"},"scheduler")," 调度器会选择高优先级的任务进入",Object(s.b)("inlineCode",{parentName:"p"},"reconciler"))),Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("p",{parentName:"li"},Object(s.b)("inlineCode",{parentName:"p"},"reconciler")," 计算变更内容(",Object(s.b)("inlineCode",{parentName:"p"},"react-dom")," 负责",Object(s.b)("inlineCode",{parentName:"p"},"DOM"),"实现（调用载体",Object(s.b)("inlineCode",{parentName:"p"},"API"),"创建、插入、删除）；具体的命令则是由 ",Object(s.b)("inlineCode",{parentName:"p"},"react-reconciler")," 给出。)"),Object(s.b)("blockquote",{parentName:"li"},Object(s.b)("p",{parentName:"blockquote"},Object(s.b)("inlineCode",{parentName:"p"},"react-reconciler")," 负责协调：生成",Object(s.b)("inlineCode",{parentName:"p"},"Fiber"),"树（",Object(s.b)("inlineCode",{parentName:"p"},"React"),"中的虚拟",Object(s.b)("inlineCode",{parentName:"p"},"DOM"),"）、协调和调度、产生操作指令。\n",Object(s.b)("inlineCode",{parentName:"p"},"react-dom "),"负责渲染：调用",Object(s.b)("inlineCode",{parentName:"p"},"DOM")," ",Object(s.b)("inlineCode",{parentName:"p"},"API"),"，将操作指令实施到",Object(s.b)("inlineCode",{parentName:"p"},"DOM"),"树上，可以将 `",Object(s.b)("inlineCode",{parentName:"p"},"react-dom 类比为 "),"react-reconciler",Object(s.b)("inlineCode",{parentName:"p"},"和"),"DOM` 之间的翻译器。"))),Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("p",{parentName:"li"},Object(s.b)("inlineCode",{parentName:"p"},"react-dom")," 把变更的内容渲染到页面"))),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"关于Fiber")),Object(s.b)(u,{title:"fiber",desc:"fiber的执行",src:"/images/fiber.png",mdxType:"ImageWrap"}),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("p",{parentName:"li"},"可以通过某些调度策略合理的分配和利用CPU从而提高用户的响应速度，通过",Object(s.b)("inlineCode",{parentName:"p"},"Filber"),"架构，让自己的调度过程可以变为可以中断，适时的让出CPU的执行权，可以让浏览器及时的响应用户的交互")),Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("p",{parentName:"li"},Object(s.b)("inlineCode",{parentName:"p"},"Filber")," 是一个执行单元，每一次执行完一个执行单元，React就会去检查当前这一帧还有多少剩余时间，如果没有了会把控制权限让出去。")),Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("p",{parentName:"li"},Object(s.b)("inlineCode",{parentName:"p"},"Filber")," 也是一种数据结构,",Object(s.b)("inlineCode",{parentName:"p"},"React"),"目前的做法是使用链表,每个",Object(s.b)("inlineCode",{parentName:"p"},"VirtualDOM"),"节点内部表示为一个",Object(s.b)("inlineCode",{parentName:"p"},"Fiber"),"。"),Object(s.b)("blockquote",{parentName:"li"},Object(s.b)("ol",{parentName:"blockquote"},Object(s.b)("li",{parentName:"ol",className:"__internal"},"从顶部开始遍历"),Object(s.b)("li",{parentName:"ol",className:"__internal"},"如果有第一个子节点，先遍历 第一个子节点"),Object(s.b)("li",{parentName:"ol",className:"__internal"},"如果没有第一个子节点，标志着此节点遍历完成"),Object(s.b)("li",{parentName:"ol",className:"__internal"},"如果有相邻节点遍历相邻节点"),Object(s.b)("li",{parentName:"ol",className:"__internal"},"如果没有下一个相邻节点，则返回上一节点并标识完成当前节点遍历，如果有上一节点有相邻节点则遍历上一节点的相邻节点"),Object(s.b)("li",{parentName:"ol",className:"__internal"},"没有上一节点则遍历结束")),Object(s.b)(u,{src:"/images/fiber-node-list.png",title:"filber的遍历",desc:"filber的遍历规则",mdxType:"ImageWrap"})),Object(s.b)("p",{parentName:"li"},"关于",Object(s.b)("inlineCode",{parentName:"p"},"Fiber"),"的简单实现"))),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," style ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    color",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"blue"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n    border",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"1px solid red"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n    margin",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"5px"'),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," FiberVirtualDOMR ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    type",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"div"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n    key",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"A1"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n    props",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        style",Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n        children",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"["),"\n            ",Object(s.b)("span",{parentName:"code",className:"token comment"},'// "A1",'),"\n            ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                type",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"div"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n                key",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"B1"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n                props",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                    style",Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n                    children",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"["),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"]"),"\n                ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n            ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                type",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"div"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n                key",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"B2"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n                props",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                    style",Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n                    children",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"["),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"]"),"\n                ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"]"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 开始我们的工作循环"),"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 表示一个工作单元,一个正在处理的fiber"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," workInProgress",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"TAG_ROOT")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"TAG_ROOT"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// fiber的根节点"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"TAG_HOST")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"TAG_HOST"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 原生节点 div  p"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," Placement ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"PLACEMENT"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," root ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," document",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"getElementById"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"app"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// fiber对象"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," rootFiber ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    type",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"TAG_ROOT"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// fiber的类型"),"\n    key",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"ROOT"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n    startNode",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," root",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// fiber对应的真实节点"),"\n    props",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        children",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"["),"FiberVirtualDOMR",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"]"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"performUnitOfWork"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"workInProgress"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"当前执行的key"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," workInProgress",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," workInProgress",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"key",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function"},"beginWork"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"workInProgress",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"workInProgress",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"child",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 如果创建完子fiber链表后，如果有第一个子节点 则返回子节点 构建子节点的下一个节点"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," workInProgress",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"child",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 如果没有下一节点则找到兄弟节点"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 只找自己下的子节点"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"while")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"workInProgress",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token function"},"completeUnitOfWork"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"workInProgress",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"//结束 没有子节点则结束"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"workInProgress",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"sibling",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," workInProgress",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"sibling",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 如果没有兄弟节点 则找上一节点的兄弟节点"),"\n        workInProgress ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," workInProgress",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"return",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 如果 全都没有找到则结束"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"completeUnitOfWork"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"workInProgress"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 创建实现的DOM 根据当前的fiber"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," startNode",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"switch")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"workInProgress",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"tag",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"case")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"TAG_HOST"),Object(s.b)("span",{parentName:"code",className:"token operator"},":"),"\n            startNode ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"createStartNode"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"workInProgress",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"break"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 完成工作单元的时候要判断当前的fiber节点有没有对应的DOM操作 构建副作用链 只要包含有副作用的节点 单链表 从第一个开始依次添加"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function"},"makeEffectList"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"workInProgress",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"makeEffectList"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"completeWork"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," returnFiber ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," completeWork",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"return",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"returnFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token operator"},"!"),"returnFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"firstEffect",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            returnFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"firstEffect ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," completeWork",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"firstEffect",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"completeWork",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"firstEffect",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 上一节点的尾部指向下一节点的头"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"returnFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"lastEffect",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                returnFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"lastEffect",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"nextEffect ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," completeWork",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"firstEffect",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 上一及节点尾部指下一节点的尾部"),"\n            returnFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"lastEffect ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," completeWork",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"lastEffect",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"completeWork",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"flags",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"returnFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"lastEffect",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                returnFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"lastEffect",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"nextEffect ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," completeWork",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"else")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                returnFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"firstEffect ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," completeWork",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n            returnFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"lastEffect ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," completeWork",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"createStartNode"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"fiber"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"fiber.startNode"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," fiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," fiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"startNode",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"fiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"tag ",Object(s.b)("span",{parentName:"code",className:"token operator"},"===")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"TAG_HOST"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," startNode ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," document",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"createElement"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"fiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"type",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        fiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"startNode ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," startNode",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," fiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"startNode",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"beginWork"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"workInProgress"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 根据当前的fiber与V-DOM构建Fiber树"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," nextChildren ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," workInProgress",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"props",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"children",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"nextChildren"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," nextChildren",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 传父节点与子节点"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"reconcileChildren"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"workInProgress",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," nextChildren",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"reconcileChildren"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"returnFiber",Object(s.b)("span",{parentName:"span",className:"token punctuation"},",")," nextChildren"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 根据父Fiber和子V-DOM数组，构建当前的treturnFiber的Fiber树"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," previousNewFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 上一个fiber子节点"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," firstChildFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 当前 returnFiber的第一个子节点"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"for")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," index ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"0"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," index ",Object(s.b)("span",{parentName:"code",className:"token operator"},"<")," nextChildren",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"length",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," index",Object(s.b)("span",{parentName:"code",className:"token operator"},"++"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," element ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," nextChildren",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"["),"index",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"]"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," newFiber ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"createFiber"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"element",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        newFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"flags ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," Placement",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 这是一个新节点，需要插入到DOM中"),"\n        newFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"return ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," returnFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token operator"},"!"),"previousNewFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 如果第一个子节点没有值,则给当前子节点赋值"),"\n            firstChildFiber ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," newFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"else")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            previousNewFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"sibling ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," newFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 指向相邻节点"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        previousNewFiber ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," newFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    returnFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"child ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," firstChildFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," firstChildFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"createFiber"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"element"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        tag",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"TAG_HOST"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 原生的DOM节点类型"),"\n        type",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," element",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"type",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// div p img span 等"),"\n        key",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," element",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"key",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 唯一标识"),"\n        props",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," element",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"props ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 属性"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"workLoop"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"while")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"workInProgress",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 空闲时间处理可以 deadline.timeRemainidng()"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 如果还有任务则继续"),"\n        workInProgress ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"performUnitOfWork"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"workInProgress",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 执行下一个任务链表"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"rootFiber"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," rootFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 提交插入"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function"},"commitRoot"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"rootFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"commitRoot"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"rootFiber"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," currentEffect ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," rootFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"firstEffect",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"while")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"currentEffect",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," flags ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," currentEffect",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"flags",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"switch")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"flags",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"case")," Placement",Object(s.b)("span",{parentName:"code",className:"token operator"},":"),"\n                ",Object(s.b)("span",{parentName:"code",className:"token function"},"commitPlacement"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"currentEffect",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n                ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"break"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        currentEffect ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," currentEffect",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"nextEffect",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 链表的下一个"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"commitPlacement"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"currentEffect"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," parent ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," currentEffect",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"return",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"startNode",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 父节点的"),"\n    parent",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"appendChild"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"currentEffect",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"startNode",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 当前正在执行的工作单位"),"\nworkInProgress ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," rootFiber",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token function"},"workLoop"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n"))),Object(s.b)("blockquote",null,Object(s.b)(u,{src:"/images/render-fiber-1.png",title:"filber实现",mdxType:"ImageWrap"}),Object(s.b)(u,{src:"/images/render-fiber-2.png",title:"filber实现",mdxType:"ImageWrap"}),Object(s.b)(u,{src:"/images/render-fiber-3.png",title:"filber实现",mdxType:"ImageWrap"})),Object(s.b)("h3",{className:"__internal",id:"153-关于dom-diff"},"1.5.3 关于DOM-DIFF",Object(s.b)("a",{parentName:"h3",href:"#153-%E5%85%B3%E4%BA%8Edom-diff","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("inlineCode",{parentName:"li"},"DOM-DIFF"),"就是根据老的",Object(s.b)("inlineCode",{parentName:"li"},"fiber"),"树和最新的",Object(s.b)("inlineCode",{parentName:"li"},"JSX"),"对比生成新的",Object(s.b)("inlineCode",{parentName:"li"},"fiber"),"树的过程"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"只对同级节点进行对比，如果DOM节点了出现跨层级移动，则",Object(s.b)("inlineCode",{parentName:"li"},"React"),"不会进行复用"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"不同类型的元素会产生不同的结构，会销毁老结构，创建新的结构"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"可以通过key标识移动元素")),Object(s.b)("ol",null,Object(s.b)("li",{parentName:"ol",className:"__internal"},"单节点")),Object(s.b)("div",{className:"rcpress-highlight","data-language":"html"},Object(s.b)("pre",{parentName:"div",className:"language-html"},Object(s.b)("code",{parentName:"pre",className:"language-html"},Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"div"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),"\n  ",Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"h1")," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"key"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"null",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"')),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),"h1",Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"h1"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">"))," 在调和阶段 老节点标记为删除\n",Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"div"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),"\n------------------------\n\n",Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"div"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),"\n  ",Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"h2")," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"key"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"null",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"')),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),"h1",Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"h2"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">"))," 在调和阶段 新节点标识为插入\n",Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"div"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),"\n"))),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},"在commit的阶段会做以下两个操作"),Object(s.b)("ol",{parentName:"blockquote"},Object(s.b)("li",{parentName:"ol",className:"__internal"},"div.removeChild(h1)"),Object(s.b)("li",{parentName:"ol",className:"__internal"},"div.apendChild(h2)"))),Object(s.b)(u,{src:"/images/diff-1.png",title:"单节点",desc:"单节点 DOM-DIFF",mdxType:"ImageWrap"}),Object(s.b)("ol",{start:2},Object(s.b)("li",{parentName:"ol",className:"__internal"},"多节点")),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul",className:"__internal"},"多节点的话情况要复杂一些，可能会设计到节点的，更新、删除、新增"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"多节点会进行两轮遍历",Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul",className:"__internal"},"第一轮主要处理节点的更新，更新包括属性与类型的更新"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"第二轮主要处理节点的新增加、删除、移动",Object(s.b)("blockquote",{parentName:"li"},Object(s.b)("p",{parentName:"blockquote"},"移动时的原则是尽量少量的移动，如果必须有一个要动，新地位高的不动，新地位低的动")))))),Object(s.b)("div",{className:"rcpress-highlight","data-language":"jsx"},Object(s.b)("pre",{parentName:"div",className:"language-jsx"},Object(s.b)("code",{parentName:"pre",className:"language-jsx"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," oldStyle",Object(s.b)("span",{parentName:"code",className:"token operator"},"="),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  border",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"3px solid red"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," margin",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"5px"'),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," newStyle",Object(s.b)("span",{parentName:"code",className:"token operator"},"="),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  border",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"3px solid blue"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," margin",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"5px"'),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," oldVDOM ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"\n  ",Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"ul"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n    "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"li")," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"key"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"A",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"style"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),"oldStyle",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}")),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"A"),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"li"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n    "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"li")," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"key"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"B",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"style"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),"oldStyle",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}")),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"B"),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"li"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n    "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"li")," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"key"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"C",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"style"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),"oldStyle",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}")),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"C"),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"li"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n    "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"li")," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"key"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"D",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"style"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),"oldStyle",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}")),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"D"),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"li"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n    "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"li")," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"key"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"E",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"style"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),"oldStyle",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}")),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"E"),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"li"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n    "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"li")," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"key"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"F",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"style"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),"oldStyle",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}")),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"F"),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"li"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n  "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"ul"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," newVDOM ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"\n  ",Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"ul"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n    "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"li")," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"key"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"A",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"style"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),"oldStyle",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}")),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"A"),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"li"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n    "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"li")," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"key"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"C",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"style"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),"oldStyle",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}")),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"C"),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"li"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n    "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"li")," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"key"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"E",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"style"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),"oldStyle",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}")),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"E"),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"li"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n    "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"li")," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"key"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"B",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"style"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),"oldStyle",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}")),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"B"),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"li"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n    "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"li")," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"key"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"G",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"style"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),"oldStyle",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}")),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"G"),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"li"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n  "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"ul"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n"))),Object(s.b)(u,{src:"/images/diff-2.png",title:"多节点",desc:"多节点 DOM-DIFF",mdxType:"ImageWrap"}),Object(s.b)("h3",{className:"__internal",id:"154-合成事件"},"1.5.4 合成事件",Object(s.b)("a",{parentName:"h3",href:"#154-%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("table",null,Object(s.b)("thead",{parentName:"table"},Object(s.b)("tr",{parentName:"thead"},Object(s.b)("th",{parentName:"tr",align:null},"类型"),Object(s.b)("th",{parentName:"tr",align:"center"},"原生事件"),Object(s.b)("th",{parentName:"tr",align:"right"},"合成事件"))),Object(s.b)("tbody",{parentName:"table"},Object(s.b)("tr",{parentName:"tbody"},Object(s.b)("td",{parentName:"tr",align:null},"命名方式"),Object(s.b)("td",{parentName:"tr",align:"center"},"全小写"),Object(s.b)("td",{parentName:"tr",align:"right"},"小驼峰命名")),Object(s.b)("tr",{parentName:"tbody"},Object(s.b)("td",{parentName:"tr",align:null},"事件处理函数"),Object(s.b)("td",{parentName:"tr",align:"center"},"字符串"),Object(s.b)("td",{parentName:"tr",align:"right"},"函数对像")),Object(s.b)("tr",{parentName:"tbody"},Object(s.b)("td",{parentName:"tr",align:null},"阻止默认行为"),Object(s.b)("td",{parentName:"tr",align:"center"},"返回",Object(s.b)("inlineCode",{parentName:"td"},"false")),Object(s.b)("td",{parentName:"tr",align:"right"},Object(s.b)("inlineCode",{parentName:"td"},"event.preventDefault()"))))),Object(s.b)("div",{className:"rcpress-highlight","data-language":"jsx"},Object(s.b)("pre",{parentName:"div",className:"language-jsx"},Object(s.b)("code",{parentName:"pre",className:"language-jsx"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"handleClick")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token parameter"},"event")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," event",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"preventDefault"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 原生"),"\n",Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"a")," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"href"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"#",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"onClick"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"handleClick",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"')),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"ok"),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"a"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),"\n\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 合成"),"\n",Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"a")," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"href"),Object(s.b)("span",{parentName:"span",className:"token attr-value"},Object(s.b)("span",{parentName:"span",className:"token punctuation attr-equals"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'),"#",Object(s.b)("span",{parentName:"span",className:"token punctuation"},'"'))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"onClick"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),"handleClick",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}")),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"ok"),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"a"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),"\n"))),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("inlineCode",{parentName:"li"},"React"),"把事件委托到了",Object(s.b)("inlineCode",{parentName:"li"},"document"),"对象上"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"当真实的DOM元素触发事件，先处理原生事件，然后会冒泡到",Object(s.b)("inlineCode",{parentName:"li"},"document"),"对象后，在处理",Object(s.b)("inlineCode",{parentName:"li"},"React"),"事件"),Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("inlineCode",{parentName:"li"},"React"),"事件绑定是发生在",Object(s.b)("inlineCode",{parentName:"li"},"reconciliation"),"阶段，会在原生事件上绑定前执行"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"为了保证浏览器的兼容,",Object(s.b)("inlineCode",{parentName:"li"},"React"),"采用的是顶层事件代码机制，保证冒泡的一致性"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"事件对象可能会频繁的创建与回收，因此",Object(s.b)("inlineCode",{parentName:"li"},"React"),"引入事件池，在事件池中获取或释放事件对象(",Object(s.b)("strong",{parentName:"li"},"17废除"),")")),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},"16 事件委托到`document上, 17是当前的容器上面"),Object(s.b)("p",{parentName:"blockquote"},"下面代码在16与17上输出顺序是不相同的")),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},Object(s.b)("inlineCode",{parentName:"p"},"event.stopPropagation")," 可以阻止冒泡，但是不能阻止后续的本级监听事件的执行"),Object(s.b)("p",{parentName:"blockquote"},"17 里面 阻止向上冒泡 ",Object(s.b)("inlineCode",{parentName:"p"},"event.nativeEvent.stopPropagation()"),"; ",Object(s.b)("inlineCode",{parentName:"p"},"event.nativeEvent.StopImmediatePropagation()"),". ",Object(s.b)("inlineCode",{parentName:"p"},"natveEvent"),"则对应原生事件")),Object(s.b)("div",{className:"rcpress-highlight","data-language":"jsx"},Object(s.b)("pre",{parentName:"div",className:"language-jsx"},Object(s.b)("code",{parentName:"pre",className:"language-jsx"},"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"class")," ",Object(s.b)("span",{parentName:"code",className:"token class-name"},"EventDom")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"extends")," ",Object(s.b)("span",{parentName:"code",className:"token class-name"},"Component")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    parentRef ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," React",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"createRef"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    childRef ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," react",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"createRef"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function"},"componentDidMount"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"parentRef",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"current",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"addEventListenner"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"\n            ",Object(s.b)("span",{parentName:"code",className:"token string"},'"click"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n            ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"父元素原生捕获"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n            ",Object(s.b)("span",{parentName:"code",className:"token boolean"},"true"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"parentRef",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"current",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"addEventListenner"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"click"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"父元素原生冒泡"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"childRef",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"current",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"addEventListenner"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"\n            ",Object(s.b)("span",{parentName:"code",className:"token string"},'"click"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n            ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"子元素原生捕获"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n            ",Object(s.b)("span",{parentName:"code",className:"token boolean"},"true"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"childRef",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"current",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"addEventListenner"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"click"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"子元素原生冒泡"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        document",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"addEventListenner"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"\n            ",Object(s.b)("span",{parentName:"code",className:"token string"},'"click"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n            ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"document捕获"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n            ",Object(s.b)("span",{parentName:"code",className:"token boolean"},"true"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        document",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"current",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"addEventListenner"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"click"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"document冒泡"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n    ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"parentBubble")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"父元素React事件冒泡"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"childBubble")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"子元素React事件冒泡"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"parentCapture")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"父元素React事件捕获"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"childCapture")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"子元素React事件捕获"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function"},"render"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"\n            ",Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"div")," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"ref"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),Object(s.b)("span",{parentName:"span",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"."),"parentRef",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}"))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"onClick"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),Object(s.b)("span",{parentName:"span",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"."),"parentBubble",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}"))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"onClickCapture"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),Object(s.b)("span",{parentName:"span",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"."),"parentCapture",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}")),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n                "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"<"),"p")," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"ref"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),Object(s.b)("span",{parentName:"span",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"."),"childRef",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}"))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"onClick"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),Object(s.b)("span",{parentName:"span",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"."),"childBubble",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}"))," ",Object(s.b)("span",{parentName:"span",className:"token attr-name"},"onClickCapture"),Object(s.b)("span",{parentName:"span",className:"token script language-javascript"},Object(s.b)("span",{parentName:"span",className:"token script-punctuation punctuation"},"="),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"{"),Object(s.b)("span",{parentName:"span",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},"."),"childCapture",Object(s.b)("span",{parentName:"span",className:"token punctuation"},"}")),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n                    onClick事件执行顺序\n                "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"p"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),Object(s.b)("span",{parentName:"code",className:"token plain-text"},"\n            "),Object(s.b)("span",{parentName:"code",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token tag"},Object(s.b)("span",{parentName:"span",className:"token punctuation"},"</"),"div"),Object(s.b)("span",{parentName:"span",className:"token punctuation"},">")),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n"))),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul",className:"__internal"},"事件捕获"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"事件目标"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"事件冒泡"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"事件委托"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"先绑定先执行")),Object(s.b)(u,{src:"/images/event-1.png",title:"事件",mdxType:"ImageWrap"}),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},Object(s.b)("strong",{parentName:"p"},"react 16"))),Object(s.b)(u,{src:"/images/event-2.png",title:"事件捕获与冒泡",mdxType:"ImageWrap"}))}k.isMDXComponent=!0,k=Object(c.hot)(e)(k),(m="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(m.register(r,"makeShortcode","E:\\h-project\\my-blog\\docs\\notes\\README.md"),m.register(l,"Footer","E:\\h-project\\my-blog\\docs\\notes\\README.md"),m.register(u,"ImageWrap","E:\\h-project\\my-blog\\docs\\notes\\README.md"),m.register(i,"FunButtonOne","E:\\h-project\\my-blog\\docs\\notes\\README.md"),m.register(j,"ClassButtonOne","E:\\h-project\\my-blog\\docs\\notes\\README.md"),m.register(O,"layoutProps","E:\\h-project\\my-blog\\docs\\notes\\README.md"),m.register("wrapper","MDXLayout","E:\\h-project\\my-blog\\docs\\notes\\README.md"),m.register(k,"MDXContent","E:\\h-project\\my-blog\\docs\\notes\\README.md")),(N="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&N(e)}.call(this,n(4)(e))}}]);