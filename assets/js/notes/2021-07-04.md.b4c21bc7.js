(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{356:function(e,a,n){"use strict";n.r(a),function(e){n.d(a,"default",(function(){return j}));var t,c=n(123),s=(n(333),n(0),n(124)),o=["components"];function p(){return(p=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,arguments)}function b(e,a){if(null==e)return{};var n,t,c=function(e,a){if(null==e)return{};var n,t,c={},s=Object.keys(e);for(t=0;t<s.length;t++)n=s[t],a.indexOf(n)>=0||(c[n]=e[n]);return c}(e,a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(t=0;t<s.length;t++)n=s[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}(t="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&t(e);"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;var m,N,r=function(e){return function(a){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(s.b)("div",a)}},u=r("Footer"),l=r("ImageWrap"),d={};function j(e){var a=e.components,n=b(e,o);return Object(s.b)("wrapper",p({},d,n,{components:a,mdxType:"MDXLayout"}),Object(s.b)("blockquote",null,Object(s.b)(u,{mdxType:"Footer"})),Object(s.b)("h1",{className:"__internal",id:"11不得不说的闭包"},"11.不得不说的闭包",Object(s.b)("a",{parentName:"h1",href:"#11%E4%B8%8D%E5%BE%97%E4%B8%8D%E8%AF%B4%E7%9A%84%E9%97%AD%E5%8C%85","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},"啥也不说先从下面这个例子看起")),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," bb ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"a"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"b"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," a ",Object(s.b)("span",{parentName:"code",className:"token operator"},"+")," b",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"a",Object(s.b)("span",{parentName:"span",className:"token punctuation"},",")," b"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," a ",Object(s.b)("span",{parentName:"code",className:"token operator"},"*")," b",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"2"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token function"},"bb"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"3"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n"))),Object(s.b)("p",null,"我们先跳过上面，请看下面的代码，并在 Chrome 控制台中调试运行一下，我们可以看到如下"),Object(s.b)(l,{title:"scopes",src:"/images/closure.png",mdxType:"ImageWrap"}),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"createClosure"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," foo ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"我是闭包"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"debugger"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n      console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"foo",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token function"},"eval"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"2+2"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"debugger"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," foo",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," c ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"createClosure"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"debugger"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token function"},"c"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n"))),Object(s.b)("p",null,"闭包是在返回一个引用了外部作用域变量的函数的时候，为了把环境保存下来，创建的一个快照，并且对作用域链做了",Object(s.b)("inlineCode",{parentName:"p"},"tree shaking"),"，只留下必要的闭包链，保存在堆里，作为对象的 [","[scopes]","] 属性。因为此时还没执行函数，所以要静态分析标识符引用，确定用到了那些变量，打包保存下来。"),Object(s.b)("h2",{className:"__internal",id:"1作用域链"},"1.作用域链",Object(s.b)("a",{parentName:"h2",href:"#1%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},"在 JavaScript 里面，函数、块都有自己的作用域，他们之间可以相互嵌套，作用域之间会形成引用关系，这条链叫做作用域链。")),Object(s.b)("h3",{className:"__internal",id:"12-静态作用域链"},"1.2 静态作用域链",Object(s.b)("a",{parentName:"h3",href:"#12-%E9%9D%99%E6%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"fun1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"A")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"A"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"fun2"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"B")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"B"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"func3"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"C")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"C"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"func4"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"D")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"D"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")))),Object(s.b)("p",null,"上面代码，我们可以看到了A,B,C,D三个变量,有fun1,fun2,fun3,fun4个函数，还一个块,关于他们之间的作用域链可以用",Object(s.b)("inlineCode",{parentName:"p"},"babel"),"转一下可以看到"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token comment"},"// test.js"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," parser ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"require"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"@babel/parser"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," traverse ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"require"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"@babel/traverse"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"default",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," code ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token template-string"},Object(s.b)("span",{parentName:"span",className:"token template-punctuation string"},"`"),Object(s.b)("span",{parentName:"span",className:"token string"},'\nfunction fun1() {\n  const A = "A";\n  function fun2() {\n      const B = "B";\n      {\n          function func3() {\n              const C = "C";\n          }\n      }\n      function func4() {\n          const D = "D";\n      }\n  }\n}\n'),Object(s.b)("span",{parentName:"span",className:"token template-punctuation string"},"`")),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ast ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," parser",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"parse"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"code",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token function"},"traverse"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"ast",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function"},"FunctionDeclaration"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"path"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"path",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"get"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"id.name"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"node ",Object(s.b)("span",{parentName:"code",className:"token operator"},"===")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"func3"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"path",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"scope",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"dump"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n"))),Object(s.b)("p",null,"babel结果如下(",Object(s.b)("inlineCode",{parentName:"p"},"FunctionDeclaration"),"函数是一个回调函数)"),Object(s.b)(l,{title:"babel结果",src:"/images/closure-babel.png",mdxType:"ImageWrap"}),Object(s.b)("p",null,"函数和块的作用域内的变量声明会在作用域 ",Object(s.b)("strong",{parentName:"p"},"（scope）")," 内创建一个绑定（变量名绑定到具体的值），然后其余地方可以引用这个绑定，这样就是静态作用域链的变量访问顺序。\n因为这样的嵌套关系是分析代码就可以得出的，不需要运行，按照这种顺序访问变量的链就是静态作用域链，这种链的好处是可以直观的知道变量之间的引用关系。静态作用域链是可以做静态分析的，比如我们刚刚用 babel 分析的 scope 链就是。"),Object(s.b)("h3",{className:"__internal",id:"13-动态作用域链"},"1.3 动态作用域链",Object(s.b)("a",{parentName:"h3",href:"#13-%E5%8A%A8%E6%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("p",null,"还有动态作用域链，也就是作用域的引用关系与嵌套关系无关，与执行顺序有关，会在执行的时候动态创建不同函数、块的作用域的引用关系。缺点就是不直观，没法静态分析。"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"func"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"A")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"闭包函数"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token constant"},"A"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," f2 ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"func"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n"))),Object(s.b)("p",null,"这就导致了一个问题，本来按照顺序创建调用一层层函数，按顺序创建和销毁作用域挺好的，但是如果内层函数返回了或者通过别的暴露出去了，那么外层函数销毁，内层函数却没有销毁，这时候怎么处理作用域，父作用域销不销毁？（比如这里的 ",Object(s.b)("inlineCode",{parentName:"p"},"func")," 调用结束要不要销毁作用域）\n我们拿上面的例子来举例"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"fun1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"A")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"A"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"fun2"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"B")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"B"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"fun3"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"C")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"C"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," fun3",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," fun2",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," fun5 ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"fun1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"首先，父作用域要不要销毁？是不是父作用域不销毁就行了？")),Object(s.b)("p",null,"不行的，父作用域中有很多东西与子函数无关，为啥因为子函数没结束就一直常驻内存。这样肯定有性能问题，所以还是要销毁。但是销毁了父作用域不能影响子函数，所以要再创建个对象，要把子函数内引用（refer）的父作用域的变量打包里来，给子函数打包带走。"),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"怎么让子函数打包带走？")),Object(s.b)("p",null,"设计个独特的属性，比如 [","[Scopes]","] ，用这个来放函数打包带走的用到的环境。并且这个属性得是一个栈，因为函数有子函数、子函数可能还有子函数，每次打包都要放在这里一个包，所以就要设计成一个栈结构，就像饭盒有多层一样。"),Object(s.b)("p",null,"我们所考虑的这个解决方案：销毁父作用域后，把用到的变量包起来，打包给子函数，放到一个属性上。这就是闭包的机制。"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"fun1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"A")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"A"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"debugger"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"fun2"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"B")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"B"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token constant"},"A"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token constant"},"B"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"debugger"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"fun3"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"C")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"C"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token constant"},"B")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token string"},'"B"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n            console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token constant"},"A"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n            console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token constant"},"B"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n            console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token constant"},"C"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"debugger"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," fun3",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," fun2",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," fun5 ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"fun1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," fun6 ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"fun5"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token function"},"fun6"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)(l,{title:"scopes",src:"/images/closure-babel-1.png",mdxType:"ImageWrap"}),Object(s.b)("p",null,"我们需要打包的只是环境内没有的，也就是",Object(s.b)("strong",{parentName:"p"},"闭包只保存外部引用。"),"然后是在创建函数的时候保存到函数属性上的，创建的函数返回的时候会打包给函数，但是 JS 引擎怎么知道它要用到哪些外部引用呢，需要做 AST 扫描，很多 JS 引擎会做 Lazy Parsing，这时候去 parse 函数，正好也能知道它用到了哪些外部引用，然后把这些外部用打包成 Closure 闭包，加到 [","[scopes]","] 中。所以，闭包是返回函数的时候扫描函数内的标识符引用，把用到的本作用域的变量打成 Closure 包，放到 [","[Scopes]","] 里。"),Object(s.b)("p",null,"闭包是为了解决子函数晚于父函数销毁的问题，我们会在父函数销毁时，把子函数引用到的变量达成 Closure 包放到函数的 [","[Scopes]","] 上，让它计算父函数销毁了也随时随地能访问外部环境。\n但是问题有时候就出在了[","[Scopes]","]上面,我们知道 JavaScript 引擎会把内存分为函数调用栈、全局作用域和堆，其中堆用于放一些动态的对象，调用栈每一个栈帧放一个函数的执行上下文，里面有一个 local 变量环境用于放内部声明的一些变量，如果是对象，会在堆上分配空间，然后把引用保存在栈帧的 local 环境中。全局作用域也是一样，只不过一般用于放静态的一些东西，有时候也叫静态域。"),Object(s.b)("p",null,"父函数销毁，栈帧对应的内存马上释放，用到的 A B 会被 gc 回收，而返回的函数会把作用域链过滤出用到的引用形成闭包链放在堆中。这就导致了一个隐患：本来作用域是随着函数调用的结束而销毁的，因为整个栈帧都会被马上销毁。而形成闭包以后，转移到了堆内存。当运行这个子函数的时候，子函数会创建栈帧，如果这个函数一直在运行，那么它在堆内存中的闭包就一直占用着内存，就会使可用内存减少，严重到一定程度就算是内存泄漏了。所以闭包不要乱用，少打包一点东西到堆内存。"),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},"补充: 执行上下文包含变量环境和词法环境，变量环境记录由let、function等声明关键字声明的变量，词法环境记录由let、const等声明关键字声明的变量，词法环境的作用是在函数作用域和全局作用域中兼容块作用域。\n执行上下文之间依赖作用域的规则来彼此引用，具体的引用依据存储为变量环境的outer。\n主线程执行的JS代码会依次从当前执行上下文中的词法环境->变量环境来查值，当无法找到时才会根据outer找到上一个执行上下文，从上一个执行上下文的词法环境->变量环境中来查找，直至找到或到达全局执行上下文为止。\n之所以某些函数可以“记忆”住已经被执行完的函数内的内容，是因为存在引用的变量不会被垃圾回收器回收掉，V8引擎仍然为这些“过去式”的变量维护着一个执行上下文，该执行上下文仍被某些执行上下文的outer所记录，这就是为什么某些函数可以“记忆”住已经被执行完的函数的内容。\n可见闭包是执行上下文的引用关系所带来的产物")),Object(s.b)("h2",{className:"__internal",id:"2闭包的使用场景"},"2.闭包的使用场景",Object(s.b)("a",{parentName:"h2",href:"#2%E9%97%AD%E5%8C%85%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("h3",{className:"__internal",id:"21-单例模式"},"2.1 单例模式",Object(s.b)("a",{parentName:"h3",href:"#21-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},"创建一次、避免重复创建带来的内存消耗")),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"singleIns"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"name"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"name ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," name",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\nsingleIns",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"getInstance ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," instance ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"null"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"name"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token operator"},"!"),Object(s.b)("span",{parentName:"code",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"instance",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"instance ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"new")," ",Object(s.b)("span",{parentName:"code",className:"token class-name"},"singleIns"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"name",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"instance",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," a ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," singleIns",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"getInstance"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"a"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," b ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," singleIns",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"getInstance"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},'"b"'),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\na ",Object(s.b)("span",{parentName:"code",className:"token operator"},"===")," b",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// true"),"\n"))),Object(s.b)("h3",{className:"__internal",id:"22-柯里化"},"2.2 柯里化",Object(s.b)("a",{parentName:"h3",href:"#22-%E6%9F%AF%E9%87%8C%E5%8C%96","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"curry"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"func"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"curried"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},Object(s.b)("span",{parentName:"span",className:"token operator"},"..."),"args"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"args",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"length ",Object(s.b)("span",{parentName:"code",className:"token operator"},">=")," func",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"length",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token function"},"func"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"apply"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," args",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"else")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},Object(s.b)("span",{parentName:"span",className:"token operator"},"..."),"args2"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token function"},"curried"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"apply"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," args",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"concat"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"args2",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// example"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"a"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"x",Object(s.b)("span",{parentName:"span",className:"token punctuation"},",")," y",Object(s.b)("span",{parentName:"span",className:"token punctuation"},",")," z"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"x ",Object(s.b)("span",{parentName:"code",className:"token operator"},"+")," y ",Object(s.b)("span",{parentName:"code",className:"token operator"},"+")," z",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," b ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"curry"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"a",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token function"},"b"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"2"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"3"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 6"),"\n",Object(s.b)("span",{parentName:"code",className:"token function"},"b"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"2"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"3"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 6"),"\n",Object(s.b)("span",{parentName:"code",className:"token function"},"b"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"2"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"3"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 6"),"\n",Object(s.b)("span",{parentName:"code",className:"token function"},"b"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"2"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"3"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 6"),"\n"))),Object(s.b)("h3",{className:"__internal",id:"23-防抖与节流"},"2.3 防抖与节流",Object(s.b)("a",{parentName:"h3",href:"#23-%E9%98%B2%E6%8A%96%E4%B8%8E%E8%8A%82%E6%B5%81","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token comment"},"// 仅执行最后一次"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"debounce"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"func",Object(s.b)("span",{parentName:"span",className:"token punctuation"},",")," time"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," timer ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"null"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},Object(s.b)("span",{parentName:"span",className:"token operator"},"..."),"args"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    timer ",Object(s.b)("span",{parentName:"code",className:"token operator"},"&&")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"clearTimeout"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"timer",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token function"},"setTimeout"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token function"},"func"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"apply"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," args",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," time",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 仅执行第一次"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"debounce"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"func",Object(s.b)("span",{parentName:"span",className:"token punctuation"},",")," time"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," timer ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"null"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  func",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"id ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"0"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},Object(s.b)("span",{parentName:"span",className:"token operator"},"..."),"args"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"func",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"id ",Object(s.b)("span",{parentName:"code",className:"token operator"},"!==")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"0"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token function"},"clearTimeout"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"timer",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    timer ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"setTimeout"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      func",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"id ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"0"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token function"},"func"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"apply"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," args",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," time",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    func",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"id ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," func",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"id ",Object(s.b)("span",{parentName:"code",className:"token operator"},"+")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n"))),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token comment"},"// 时间戳方式"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"throttle"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"func",Object(s.b)("span",{parentName:"span",className:"token punctuation"},",")," time"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," start ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"new")," ",Object(s.b)("span",{parentName:"code",className:"token class-name"},"Date"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},Object(s.b)("span",{parentName:"span",className:"token operator"},"..."),"args"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token keyword"},"new")," ",Object(s.b)("span",{parentName:"code",className:"token class-name"},"Date"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"-")," start ",Object(s.b)("span",{parentName:"code",className:"token operator"},">=")," time",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token function"},"func"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"apply"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token keyword"},"this"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," args",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n      start ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"new")," ",Object(s.b)("span",{parentName:"code",className:"token class-name"},"Date"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n"))),Object(s.b)("h3",{className:"__internal",id:"24-模块化"},"2.4 模块化",Object(s.b)("a",{parentName:"h3",href:"#24-%E6%A8%A1%E5%9D%97%E5%8C%96","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"module"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," pool ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"["),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"]"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"add"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"item"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    pool",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"push"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"item",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," pool",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"remove"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"num"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    pool",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"forEach"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"item",Object(s.b)("span",{parentName:"span",className:"token punctuation"},",")," index"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=>")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"item ",Object(s.b)("span",{parentName:"code",className:"token operator"},"===")," num",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        pool",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"splice"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"index",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n      ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," pool",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n  ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    add",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," add",Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n    remove",Object(s.b)("span",{parentName:"code",className:"token operator"},":")," remove",Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),"\n  ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," foo ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"module"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\nfoo",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"add"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\nfoo",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"remove"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n"))),Object(s.b)("h3",{className:"__internal",id:"25-动态创建"},"2.5 动态创建",Object(s.b)("a",{parentName:"h3",href:"#25-%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BA","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("p",null,"比喻需要根据浏览器的兼容来使用监听事件"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," whichEvent ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token keyword"},"function"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"document",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"addEventListener",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"element",Object(s.b)("span",{parentName:"span",className:"token punctuation"},",")," event",Object(s.b)("span",{parentName:"span",className:"token punctuation"},",")," handler"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"element ",Object(s.b)("span",{parentName:"code",className:"token operator"},"&&")," event ",Object(s.b)("span",{parentName:"code",className:"token operator"},"&&")," handler",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                element",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"addEventListener"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"event",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," handler",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," ",Object(s.b)("span",{parentName:"code",className:"token boolean"},"false"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"else")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"element",Object(s.b)("span",{parentName:"span",className:"token punctuation"},",")," event",Object(s.b)("span",{parentName:"span",className:"token punctuation"},",")," handler"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"element ",Object(s.b)("span",{parentName:"code",className:"token operator"},"&&")," event ",Object(s.b)("span",{parentName:"code",className:"token operator"},"&&")," handler",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                element",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"attachEvent"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token string"},"'on'")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"+")," event",Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," handler",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";"),"\n"))),Object(s.b)("h3",{className:"__internal",id:"26持久化数据斐波那契数列"},"2.6持久化数据(斐波那契数列)",Object(s.b)("a",{parentName:"h3",href:"#26%E6%8C%81%E4%B9%85%E5%8C%96%E6%95%B0%E6%8D%AE%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},"    ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"fb")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"fn"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"n"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"n ",Object(s.b)("span",{parentName:"code",className:"token operator"},"===")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"1")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"||")," n ",Object(s.b)("span",{parentName:"code",className:"token operator"},"===")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"2"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"1"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," num ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"fn"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"n ",Object(s.b)("span",{parentName:"code",className:"token operator"},"-")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"+")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"fn"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"n ",Object(s.b)("span",{parentName:"code",className:"token operator"},"-")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"2"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," num\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," fn\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n    console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token function"},"fb"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"100"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n"))),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",{parentName:"div",className:"language-js"},Object(s.b)("code",{parentName:"pre",className:"language-js"},"   ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," ",Object(s.b)("span",{parentName:"code",className:"token function-variable function"},"fb")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," cache ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"["),Object(s.b)("span",{parentName:"code",className:"token number"},"0"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},","),Object(s.b)("span",{parentName:"code",className:"token number"},"1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"]")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 建立缓存区"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"function")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"fn"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token parameter"},"n"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," num ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," cache",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"["),"n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"]"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"if"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token keyword"},"typeof")," num ",Object(s.b)("span",{parentName:"code",className:"token operator"},"!==")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'number'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"{")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 如果缓存区没有当前位数对应的斐波那契值"),"\n                cache",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"["),"n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"]")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"fn"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"n",Object(s.b)("span",{parentName:"code",className:"token operator"},"-"),Object(s.b)("span",{parentName:"code",className:"token number"},"1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token operator"},"+")," ",Object(s.b)("span",{parentName:"code",className:"token function"},"fn"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"n",Object(s.b)("span",{parentName:"code",className:"token operator"},"-"),Object(s.b)("span",{parentName:"code",className:"token number"},"2"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 当前位数对应的斐波那契值加入缓存"),"\n                num ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," cache",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"["),"n",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"]"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n            ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," num ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 如果缓存区有当前位数对应的斐波那契值，直接返回"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"return")," fn\n    ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"}"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n    console",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"log"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token function"},"fb"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"1000"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),"\n"))))}j.isMDXComponent=!0,j=Object(c.hot)(e)(j),(m="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(m.register(r,"makeShortcode","E:\\h-project\\my-blog\\docs\\notes\\2021-07-04.md"),m.register(u,"Footer","E:\\h-project\\my-blog\\docs\\notes\\2021-07-04.md"),m.register(l,"ImageWrap","E:\\h-project\\my-blog\\docs\\notes\\2021-07-04.md"),m.register(d,"layoutProps","E:\\h-project\\my-blog\\docs\\notes\\2021-07-04.md"),m.register("wrapper","MDXLayout","E:\\h-project\\my-blog\\docs\\notes\\2021-07-04.md"),m.register(j,"MDXContent","E:\\h-project\\my-blog\\docs\\notes\\2021-07-04.md")),(N="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&N(e)}.call(this,n(3)(e))}}]);