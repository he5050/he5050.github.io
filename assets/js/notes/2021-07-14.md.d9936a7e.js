(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{318:function(e,a,t){"use strict";t.r(a),function(e){t.d(a,"default",(function(){return u}));var n,c=t(107),s=(t(303),t(0),t(108)),o=["components"];function b(){return(b=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function p(e,a){if(null==e)return{};var t,n,c=function(e,a){if(null==e)return{};var t,n,c={},s=Object.keys(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||(c[t]=e[t]);return c}(e,a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(c[t]=e[t])}return c}(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e);"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;var r,l,i=function(e){return function(a){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(s.b)("div",a)}},m=i("Footer"),N={};function u(e){var a=e.components,t=p(e,o);return Object(s.b)("wrapper",b({},N,t,{components:a,mdxType:"MDXLayout"}),Object(s.b)("blockquote",null,Object(s.b)(m,{mdxType:"Footer"})),Object(s.b)("h1",{className:"__internal",id:"5web-audio-api-介绍"},"5.Web Audio API 介绍",Object(s.b)("a",{parentName:"h1",href:"#5web-audio-api-%E4%BB%8B%E7%BB%8D","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("p",null,Object(s.b)("img",{parentName:"p",src:"https://camo.githubusercontent.com/28c82d0e9602a674c2e39c85becd03061df52004/687474703a2f2f73746f726167652e333630627579696d672e636f6d2f6d74642f686f6d652f6c696e65313530303631393336333136372e6a7067",alt:"进化史"})),Object(s.b)("h2",{className:"__internal",id:"web-audio-api-介绍"},"Web Audio API 介绍",Object(s.b)("a",{parentName:"h2",href:"#web-audio-api-%E4%BB%8B%E7%BB%8D","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("p",null,"首先，了解一下什么是 Web Audio API，它是在 HTML5 中新增加的一个 API，但似乎大家对它的印象并不深，更多的是记住了它的其他兄弟（Web Storage API、Canvas API），Web Audio API 提供了在 Web 上控制音频的一个非常有效通用的系统，允许开发者来自选音频源，对音频进行处理。"),Object(s.b)("p",null,"Web Audio API 不等于 ",Object(s.b)("inlineCode",{parentName:"p"},"<audio>")," 元素"),Object(s.b)("p",null,"因为它有",Object(s.b)("strong",{parentName:"p"},"非常丰富的 API")),Object(s.b)("p",null,Object(s.b)("img",{parentName:"p",src:"https://camo.githubusercontent.com/aeff602b92c3b069a299e847a0353a10086c5a23/687474703a2f2f73746f726167652e333630627579696d672e636f6d2f6d74642f686f6d652f7765625f617564696f5f6170695f6c697374313530303631393336343135352e6a7067",alt:"API 清单"})),Object(s.b)("h2",{className:"__internal",id:"那它到底能干什么？"},"那它到底能干什么？",Object(s.b)("a",{parentName:"h2",href:"#%E9%82%A3%E5%AE%83%E5%88%B0%E5%BA%95%E8%83%BD%E5%B9%B2%E4%BB%80%E4%B9%88%EF%BC%9F","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul",className:"__internal"},"对简单或复杂的音频进行混合"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"精确控制音频的密度和节奏"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"内置淡入/淡出，颗粒噪点，音频控制等效果"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"灵活的处理在音频流的声道，可拆分可合并"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"处理  音频或  视频上的音频源"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"使用 MediaStream 的 getUserMedia() 方法实时处理输入的音频，如：变声"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"立体音效，支持多种 3D 游戏和沉浸式环境"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"利用卷积引擎，创建各类线性音效，例如小/大房间、大教堂、音乐厅等，适用于创建高质量的房间效果"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"实时的时域和频分析，实现音频可视化"),Object(s.b)("li",{parentName:"ul",className:"__internal"},"很多音频波形算法控制")),Object(s.b)("h2",{className:"__internal",id:"通过钢琴例子来初步了解"},"通过钢琴例子来初步了解",Object(s.b)("a",{parentName:"h2",href:"#%E9%80%9A%E8%BF%87%E9%92%A2%E7%90%B4%E4%BE%8B%E5%AD%90%E6%9D%A5%E5%88%9D%E6%AD%A5%E4%BA%86%E8%A7%A3","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("p",null,"88 个琴键（52 个白键、36 个黑键组成）"),Object(s.b)("p",null,Object(s.b)("img",{parentName:"p",src:"https://camo.githubusercontent.com/04118c3e2a6e75fb86a97ad145717912f06142be/687474703a2f2f73746f726167652e333630627579696d672e636f6d2f6d74642f686f6d652f7069616e6f313530303631393736303331362e6a7067",alt:"钢琴"})),Object(s.b)("p",null,"重点：声音是由硬件生成的，并不是用 mp3、wav 等格式播放出来的\n通过十几二十行的 JS 代码就能实现"),Object(s.b)("h2",{className:"__internal",id:"实现的代码"},"实现的代码",Object(s.b)("a",{parentName:"h2",href:"#%E5%AE%9E%E7%8E%B0%E7%9A%84%E4%BB%A3%E7%A0%81","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("p",null,"1、兼容老的 webkit 浏览器"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(s.b)("pre",{parentName:"div",className:"language-javascript"},Object(s.b)("code",{parentName:"pre",className:"language-javascript"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"const")," audioCtx ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"new")," ",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"window",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"AudioContext ",Object(s.b)("span",{parentName:"code",className:"token operator"},"||")," window",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"webkitAudioContext",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"2、创建新的音频上下文接口"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(s.b)("pre",{parentName:"div",className:"language-javascript"},Object(s.b)("code",{parentName:"pre",className:"language-javascript"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," audioCtx ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token keyword"},"new")," ",Object(s.b)("span",{parentName:"code",className:"token class-name"},"AudioContext"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"3、创建一个 OscillatorNode 它表示一个周期性波形（振荡）（抽象表达形式）声音是由物体振动产生的，这里可以理解为创建一个音调"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(s.b)("pre",{parentName:"div",className:"language-javascript"},Object(s.b)("code",{parentName:"pre",className:"language-javascript"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," oscillator ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," audioCtx",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"createOscillator"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"4、创建一个 GainNode 控制音频的总音量"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(s.b)("pre",{parentName:"div",className:"language-javascript"},Object(s.b)("code",{parentName:"pre",className:"language-javascript"},Object(s.b)("span",{parentName:"code",className:"token keyword"},"let")," gainNode ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," audioCtx",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"createGain"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"5、将音调和音频关联起来"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(s.b)("pre",{parentName:"div",className:"language-javascript"},Object(s.b)("code",{parentName:"pre",className:"language-javascript"},"oscillator",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"connect"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"gainNode",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"6、将音量和设备关联，一般情况下是扬声器"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(s.b)("pre",{parentName:"div",className:"language-javascript"},Object(s.b)("code",{parentName:"pre",className:"language-javascript"},"gainNode",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"connect"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"audioCtx",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"destination",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"7、指定音调为正弦波类型 ",Object(s.b)("inlineCode",{parentName:"p"},"square")," 方波 | ",Object(s.b)("inlineCode",{parentName:"p"},"triangle")," 三角波 | ",Object(s.b)("inlineCode",{parentName:"p"},"sawtooth")," 锯齿波 ",Object(s.b)("inlineCode",{parentName:"p"},"setPeriodicWave()")," 方法自定义波形"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(s.b)("pre",{parentName:"div",className:"language-javascript"},Object(s.b)("code",{parentName:"pre",className:"language-javascript"},"oscillator",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"type ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," ",Object(s.b)("span",{parentName:"code",className:"token string"},"'sine'"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")," ",Object(s.b)("span",{parentName:"code",className:"token comment"},"// 正弦波")))),Object(s.b)("p",null,"8、设置当前播放声音的频率"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(s.b)("pre",{parentName:"div",className:"language-javascript"},Object(s.b)("code",{parentName:"pre",className:"language-javascript"},"oscillator",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"frequency",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"value ",Object(s.b)("span",{parentName:"code",className:"token operator"},"=")," frequency",Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"9、",Object(s.b)("inlineCode",{parentName:"p"},"currentTime")," 的值是双精度浮点型数字，返回硬件调用的秒数这个时间无法改变，从 new ",Object(s.b)("inlineCode",{parentName:"p"},"AudioContext")," 开始就会一直累加表示把当前的时间的音量设置为 0"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(s.b)("pre",{parentName:"div",className:"language-javascript"},Object(s.b)("code",{parentName:"pre",className:"language-javascript"},"gainNode",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"gain",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"setValueAtTime"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"0"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," audioCtx",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"currentTime",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"10、",Object(s.b)("inlineCode",{parentName:"p"},"linearRampToValueAtTime")," 表示某时间线性变化到某值表示当前时间 0.01 秒后，声音线性的从 0 增加到 1"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(s.b)("pre",{parentName:"div",className:"language-javascript"},Object(s.b)("code",{parentName:"pre",className:"language-javascript"},"gainNode",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"gain",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"linearRampToValueAtTime"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," audioCtx",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"currentTime ",Object(s.b)("span",{parentName:"code",className:"token operator"},"+")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"0.01"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"11、开始播放音调"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(s.b)("pre",{parentName:"div",className:"language-javascript"},Object(s.b)("code",{parentName:"pre",className:"language-javascript"},"oscillator",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"start"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"audioCtx",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"currentTime",Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"12、",Object(s.b)("inlineCode",{parentName:"p"},"exponentialRampToValueAtTime")," 表示音量在某个时间指数变化到某值这里表示在 1 秒内，音量由之前的 1 指数曲线的速度降至到 0.001 的音量"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(s.b)("pre",{parentName:"div",className:"language-javascript"},Object(s.b)("code",{parentName:"pre",className:"language-javascript"},"gainNode",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"gain",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"exponentialRampToValueAtTime"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),Object(s.b)("span",{parentName:"code",className:"token number"},"0.001"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},",")," audioCtx",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"currentTime ",Object(s.b)("span",{parentName:"code",className:"token operator"},"+")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("p",null,"13、1 秒后完全停止音乐"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(s.b)("pre",{parentName:"div",className:"language-javascript"},Object(s.b)("code",{parentName:"pre",className:"language-javascript"},"oscillator",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),Object(s.b)("span",{parentName:"code",className:"token function"},"stop"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},"("),"audioCtx",Object(s.b)("span",{parentName:"code",className:"token punctuation"},"."),"currentTime ",Object(s.b)("span",{parentName:"code",className:"token operator"},"+")," ",Object(s.b)("span",{parentName:"code",className:"token number"},"1"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},")"),Object(s.b)("span",{parentName:"code",className:"token punctuation"},";")))),Object(s.b)("h2",{className:"__internal",id:"兼容性"},"兼容性",Object(s.b)("a",{parentName:"h2",href:"#%E5%85%BC%E5%AE%B9%E6%80%A7","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("p",null,"iOS 支持性很好，微信下 X5 同样也不错，所以不用担心"),Object(s.b)("p",null,Object(s.b)("img",{parentName:"p",src:"https://camo.githubusercontent.com/4ebda0bd01efe4cc02bb2aa2952f7d0717aa85b7/687474703a2f2f73746f726167652e333630627579696d672e636f6d2f6d74642f686f6d652f63616e69757365313530303632303132353639332e6a7067",alt:"Can I use"})),Object(s.b)("p",null,Object(s.b)("img",{parentName:"p",src:"https://camo.githubusercontent.com/459220495012323166daef13b751b8cdea8e132b/687474703a2f2f73746f726167652e333630627579696d672e636f6d2f6d74642f686f6d652f78352d63616e69757365313530303632303132363337352e6a7067",alt:"X5 Can I user"})),Object(s.b)("h2",{className:"__internal",id:"web-音频库推荐"},"Web 音频库推荐",Object(s.b)("a",{parentName:"h2",href:"#web-%E9%9F%B3%E9%A2%91%E5%BA%93%E6%8E%A8%E8%8D%90","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("a",{parentName:"li",href:"https://alemangui.github.io/pizzicato/",target:"_blank"},"Pizzicato.js")),Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("a",{parentName:"li",href:"https://github.com/jeromeetienne/webaudiox",target:"_blank"},"webaudiox.js")),Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("a",{parentName:"li",href:"https://github.com/goldfire/howler.js",target:"_blank"},"howler.js")),Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("a",{parentName:"li",href:"https://tonejs.github.io/",target:"_blank"},"Tone.js")),Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("a",{parentName:"li",href:"https://github.com/goldfire/howler.js",target:"_blank"},"WAD"))),Object(s.b)("h2",{className:"__internal",id:"参考资料"},"参考资料",Object(s.b)("a",{parentName:"h2",href:"#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99","aria-hidden":!0,className:"anchor"},"#")),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("a",{parentName:"li",href:"www.zhangxinxu.com/wordpress/2017/06/html5-web-audio-api-js-ux-voice/"},"利用HTML5 Web Audio API给网页JS交互增加声音 ")),Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Visualizations_with_Web_Audio_API",target:"_blank"},"Visualizations with Web Audio API")),Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("a",{parentName:"li",href:"https://developer.mozilla.org/zh-CN/docs/Web/API/AudioContext",target:"_blank"},"AudioContext")),Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("a",{parentName:"li",href:"https://css-tricks.com/introduction-web-audio-api/",target:"_blank"},"Introduction to Web Audio API")),Object(s.b)("li",{parentName:"ul",className:"__internal"},Object(s.b)("a",{parentName:"li",href:"https://wenku.baidu.com/view/99b7a5194431b90d6c85c7b0.html",target:"_blank"},"钢琴键频率对照表"))))}u.isMDXComponent=!0,u=Object(c.hot)(e)(u),(r="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(r.register(i,"makeShortcode","E:\\h-project\\my-blog\\docs\\notes\\2021-07-14.md"),r.register(m,"Footer","E:\\h-project\\my-blog\\docs\\notes\\2021-07-14.md"),r.register(N,"layoutProps","E:\\h-project\\my-blog\\docs\\notes\\2021-07-14.md"),r.register("wrapper","MDXLayout","E:\\h-project\\my-blog\\docs\\notes\\2021-07-14.md"),r.register(u,"MDXContent","E:\\h-project\\my-blog\\docs\\notes\\2021-07-14.md")),(l="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&l(e)}.call(this,t(5)(e))}}]);